

<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="resources/twentytwenty.css" rel="stylesheet" type="text/css" />

    <title>Computer Graphics 2022</title>

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Computer Graphics 2022 Final Project" />
    <meta property="og:description" content="Hello" />


<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’«</text></svg>">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.8.0/codemirror.min.css">
    <link rel="stylesheet" href="css/app.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.8.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.3/clipboard.min.js"></script>
    
    <script src="js/app.js"></script>
    <script type = "text/javascript">
        function showDiv( name) {
            var x = document.getElementById(name);
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }
    </script>



</head>

<body>
    
    <div class="container" id="main">
        <div class="row">
            <br><br><br><br>
            <h1 class="col-md-12 text-center">
                <b>Computer Graphics 2022</b> <br>ETH Zurich</br> 
                <small>
								Matias Turkulainen
                </small>
            </h1>
        </div>

        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <br>
                <h1>
                </h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <h3>
                    Introduction
                </h3>
                <p class="text-justify">
                    This website serves as a demo page for my work in the Computer Graphics course at ETH Zurich. 
                    I extended the minimalistic ray tracer <a href="https://cgl.ethz.ch/teaching/cg22/www-nori/index.html">Nori</a> written in C++ with additional features to render the images shown here. 
                </p>
            </div>
        </div>



        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <h3>
                    Motivation
                </h3>
                <p class="text-justify">
                    My main motivation for the project was to tackle some of the challenging effects seen in images like the one below. I wanted to simulate volumetric scattering of light in a medium, difficult environmental maps, as well as realistic cameras with the thin lens equation.
                </p>
                <br>
                <div class="text-center">
                    <div style="position:relative;padding-top:56.25%;">
                        <img src="images/motivation.png" alt="Motivational image" style="position:absolute;top:0;left:0;width:100%;height:100%;">
                    </div>
                </div>
                <br>
            </div>
        </div>

        <!--Distortion--> 
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <br>
                <h1>
                    Simple Features
                </h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <br>
                <h3>
                    Lens distortion
                </h3>
                <p class="text-justify"> Lens distortion occurs in image formation with real lenses that deviate from the naive pinhole approximation. Light entering the optical lens off-center is distorted by the curvature of the lens.
                    Radial distortion refers to the unequal bending of light depending on where light rays hit the lens relative to its optical center. Light further away from the optical center is distorted more.
                    Radial distortion can be modelled using a polynomial radial distortion model as explained <a href="https://docs.opencv.org/3.4/d9/d0c/group__calib3d.html">here (OpenCV)</a>. Mapping from undistorted pixels is determined by
                the radial coefficients K1, K2, and K3. Barell distortion occurs with positive coefficients and Pinchusion distortion occurs with negative coefficients. </p>
                <div class="col-md-4">
                    <div class="twentytwenty-container">
                        <img src="images/distortion/distortion_base.png" alt="Mine" class="img-responsive" >
                        <img src="images/distortion/normal.png" alt="Reference" class="img-responsive%;" >
                    </div> 
                </div> 
                <div class="col-md-4">
                <div class="twentytwenty-container">
                    <img src="images/distortion/distortion_base_1.png" alt="Mine" class="img-responsive" >
                    <img src="images/distortion/barell.png" alt="Reference Barrel Distortion" class="img-responsive%;" >
                </div> 
                </div>
                <div class="col-md-4">
                    <div class="twentytwenty-container">
                        <img src="images/distortion/distortion_base_2.png" alt="Mine" class="img-responsive"  >
                        <img src="images/distortion/pin.png" alt="Reference Pinchusion Distortion" class="img-responsive%;" >
                </div> 
                </div>

                <div class="col-md-4">
                    <pre><xmp > K1 = 0, K2 = 0, K3 = 0</xmp></pre>
                </div>
                <div class="col-md-4">
                    <pre><xmp > K1 = 1, K2 = 1, K3 = 0</xmp></pre>
                </div>
                <div class="col-md-4">
                    <pre><xmp > K1 = -1, K2 = -1, K3 = 0</xmp></pre>
                </div>
            </div>
            <br><br>
            <div class="col-md-8 col-md-offset-2" >
                <input type="button" name="answer" value="Code" onclick='showDiv(name = "myDIV")' />
            </div>
            <div class="col-md-8 col-md-offset-2">
                <div id="myDIV"  style="display:none;" class="" > 
<pre><xmp>/*Code implementation of polynomial distortion in perspective.cpp camera class
*/
float K1 = m_K1;
float K2 = m_K2;
float K3 = m_K3;

if (K1 != 0 || K2 != 0 || K3 != 0){
    // Original radius 
    float r = Vector2f(nearP.x() / nearP.z(), nearP.y() / nearP.z()).norm();
    // Polynomial Radial distortion
    nearP.x() *= (1 + K1 * pow(r, 2) + K2 * pow(r,4) + K3 * pow(r, 6));
    nearP.y() *= (1 + K1 * pow(r, 2) + K2 * pow(r,4) + K3 * pow(r, 6));
}  
</xmp></pre>
</div>
                    
            </div>        
        </div>

        <!--Depth of Field--> 
        <br>
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <h3>
                    Depth of Field
                </h3>
                <p class="text-justify">
                    Depth of field is a light transport phenomena that occurs through thin lenses. The size of the lens aperature and the focal length of the lens has an effect on where light is in focus on the image plane. 
                    Varying the aperature and the focal length changes what objects are in focus in the image. 
                </p>
                <div class="col-md-18">
                
                    <div class="twentytwenty-container">
                        <img src="images/depthOfField/mine/dof_base.png" alt="Reference" class="img-responsive" >
                        <img src="images/depthOfField/mine/dof_base_r_0.01.png" alt="Lens radius 0.01" class="img-responsive%;" >
                        <img src="images/depthOfField/mine/dof_base_r_0.05.png" alt="Lens radius 0.05" class="img-responsive%;" >
                        <img src="images/depthOfField/mine/dof_base_r_0.1.png" alt="Lens radius 0.1" class="img-responsive%;" >
                    </div> 
                    <pre> Varying lens radius with focal distance of 50. 100 Samples Per Pixel.</pre>
                </div>
                                            <!--code--> 
                                            <div class="col-md-14" pre>
                                                <input type="button" name="answer" value="Code" onclick='showDiv(name = "myDIV5")'/>
                                            </div>
                                               <div class="col-md-14">
                                                    <div id="myDIV5"  style="display:none;" class="" > 
                                                        <pre> 
                                <xmp>/* Code implementation of DoF in perspective.cpp camera class
*/
ray.o = m_cameraToWorld * Point3f(0, 0, 0);
ray.d = m_cameraToWorld * d;
ray.mint = m_nearClip * invZ;
ray.maxt = m_farClip * invZ;
ray.update();

// Implement Depth of Field
if(m_lensr > 0){ // Thin lens assumption
    //1. sample point on thin lens and scale by lensr
    Point2f pLens = m_lensr * Warp::squareToUniformDisk(apertureSample);

    // 2. compute intersection point on plane of focus. found by t*ray.z() = focal length
    float ft = m_focald/d.z();
    Point3f pFocus = d * ft;

    // 3. update ray for effect of lens. Ray origin and direction.  
    Point3f o(pLens.x(), pLens.y(), 0);
    ray.o = m_cameraToWorld * o;
    d = (pFocus - o).normalized();
    ray.d = m_cameraToWorld * d;
}
return Color3f(1.0f);</xmp> </pre>
                                                    </div>
                                               </div>
                                        </p>

            </div>
        </div>

        <!--Image textures--> 
        <br>
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <h3>
                    Image Textures
                </h3>
                <p class="text-justify">
                    Texturing meshes in a scene is vital for any modern renderer. One way to texture meshes is to directly use images and to define a function that maps pixel colors to mesh locations. 
                    The method of image textures map pixel coordinates and associated RGB values in .png/.jpg images to object level uv-coordinates defined for a mesh in a scene.
                    When a light ray intersects an object in the scene, the intersection point record stores a uv-coordinate value for the mesh intersection. This uv-coordinate is then mapped
                    to a color value in a RGB image which is given to the shader such that an appropriate color can be rendered. 
                    Each mesh type in a renderer must define a unique mapping from 3D intersection points to uv-coordinates which can be used for texture mapping. The overall pipeline from light ray intersections to RGB values is illustrated below.
                        <center>  <pre> f(x,y,z) -> (u,v); T(u,v) -> (R,G,B)</pre></center>

                    In Nori, I implement the image texture mapping fuction T(u,v). I map the uv-coordinate domain [0,1]<sup>2</sup> to pixel values on [height,width] with associated RGB color. I include the <a href="https://github.com/nothings/stb">stb</a> library for efficient image loading.
                    I do not implement filtering, scale, or gamma correction, I do not cache or preload image textures in a scene (important for large scenes), and I only provide support for RGB Spectrum images. 
                </p> <br> 
                <div class="col-md-4">
                    <div class="twentytwenty-container">
                        <img src="images/textures/earthcloudmap.jpg" alt="Cloudy Earth" class="img-responsive" >
                    </div> 
                </div> 
                <div class="col-md-4">
                <div class="twentytwenty-container">
                    <img src="images/textures/earthmap1k.jpg" alt="Earth" class="img-responsive" >
                </div> 
                </div>
                <div class="col-md-4">
                    <div class="twentytwenty-container">
                        <img src="images/textures/sunmap.jpg" alt="Sun" class="img-responsive"  >
                </div> <br>
                </div>
                <br>
                <p class="text-justify">
                    I use high detail 4K texture maps of planets from the following <a href="http://planetpixelemporium.com/index.php">source</a> for my texture maps. See the code below for the full implementation and a few renders of image texture mapping of planets. 
                </p>
                

            </div>

<br>
               <!--code--> 
               <div class="col-md-8 col-md-offset-2" >
                <input type="button" name="answer" value="image_textures.cpp" onclick='showDiv(name = "myDIV2")'/>
            </div>
               <div class="col-md-8 col-md-offset-2">
                    <div id="myDIV2"  style="display:none;" class="" > 
                        <pre> 
<xmp>
    /*
    Image Textures
    by: Matias Turkulainen
    */

    #include <nori/stb_image.h>
    #include <nori/texture.h>
    #include <filesystem/resolver.h>
    
    NORI_NAMESPACE_BEGIN
    
    class Image_texture : public Texture<Color3f> {
    public:
    
        Image_texture(const PropertyList &props) {
            m_path= props.getString("image_path", "");
            filesystem::path image_path = getFileResolver()->resolve(m_path);
            int width, height, channels;
            unsigned char *image = stbi_load(image_path.str().c_str(), &width, &height, &channels, 3);
            if(image == NULL) {
              printf("Error in loading the image\n");
              exit(1);
            }
    
            m_image = image;
            m_width = width;
            m_height = height;
            m_channels = channels;
        }
    
        // Map (u,v) to (r,g,b)
        Color3f eval(const Point2f & uv) {
            // map (u,v) [0,1] -> image pixels (x,y) [0,width/height]
    
            int x = int(uv.x() * m_width) ;
            int y = int((uv.y()) * m_height) ;
            
            float r = m_image[(y*m_width +x) * m_channels +0] /255.0 ;
            float g = m_image[(y*m_width +x) * m_channels +1] /255.0 ;
            float b = m_image[(y*m_width +x) * m_channels +2] /255.0;
            
            return Color3f(r, g, b);
        }
    
        std::string toString() const {
            return tfm::format(
                    "Image_texture[\n"
                    "  m_name = %s\n"
                    "]",
                    m_path // TODO: add rest of params toString
                );
        }
    
    protected:
        std::string m_path;
        unsigned char * m_image;
        unsigned m_width;
        unsigned m_height;
        unsigned m_channels;
    };
    
    NORI_REGISTER_CLASS(Image_texture, "image_texture")
    NORI_NAMESPACE_END
</xmp>
                        </pre>
                    </div>
               </div>
                
            </div>
                <!--/code--> 
            <br>
            <br>
            <div class="col-md-8 col-md-offset-2">
                <div style="position:relative;">
                    <div class="twentytwenty-container">
                        <img src="images/textures/planets_2.png" alt="Sun" class="img-responsive" >
                        <img src="images/textures/jupiter.png" alt="Jupiter" class="img-responsive%;" >
                        <img src="images/textures/cloud.png" alt="Cloudy Earth" class="img-responsive%;" >
                        <img src="images/textures/earth.png" alt="Earth" class="img-responsive%;" >
                    </div> 
                </div>
                <br><br>
            
            </div>
            <div class="col-md-8 col-md-offset-2">
            <p class = "text-justify">
                For validation, I attempted to recreate the same scene in Mitsuba3; however, I struggled with getting the correct lighting condition and camera transformation as in Nori. There is a rotation offset in the reference image.
            </p>
            </div>

            <div class="col-md-6 col-md-offset-3">
                <div style="position:relative;">
                    <div class="twentytwenty-container">
                        <img src="images/textures/validation.png" alt="Mine" class="img-responsive" >
                        <img src="images/textures/mitsuba_ref.png"" alt="Mitsuba3 Reference" class="img-responsive%;" >
                    </div> 
                </div>
                <br><br>
            
            </div>
        <!--Procedural Textures--> 
                   <div class="row">
                    <div class="col-md-8 col-md-offset-2">
                        <h3>
                            Procedural Textures
                        </h3>
                        <p class="text-justify">
                            A limitation with texture mapping is the need to store high resolution images which can still become blurry for close-up renders. Procedural textures attempt to combat this by defining
                            the uv-coordinate to texture mapping with an explicit algorithm. Ideally, this allows for infinite resolution in your texture map, as you can query your procedural texture with the continuous uv-domain [0,1].
                            Finding a suitable algorithm for a desired texture is the crux of the challenge. Various algorithms exist for tessallation, such as the canonical checkerboard pattern (which I also implemented in Nori), and cellular texturing. 
                            More advanced mathematical functions, like the mandelbrot set, can also be defined as a procedural texture. 
                            <br> <br>
                            Another approach for generating textures algorithmically is to use a random texture generating function. The first random texture generator, referred to as the <i>Image Synthesizer</i> in the Ken Perlin's 1983 SIGGRAPH paper, was the 
                            <a href="https://en.wikipedia.org/wiki/Perlin_noise">Perlin</a> noise function. It is a useful tool to naturally texture many objects in a scene without having to explicitly define image texture maps.
                            Perlin textures have also been used to create virtual <a href="https://we.copernicus.org/articles/22/1/2022/">landscapes</a> (publication date Feb, 2022) with varying parameters, e.g. height of hills or other scene elements.
                            A notable example is the random scene generation in Minecraft.
                            <br> <br>
                            The main idea behind the algorithm is a random function, referred to as a noise function, that maps 2D uv-coordinates to points in multiple random waves of varying amplitude and frequency which are summed together to create a texture output value.
                            The key insight is that the mapping is made with a pseudo-random number generator which ensures that identical 2D uv-coordinates are mapped to the same output texture of the random function.
                            This is a seeded random function and changing the seed with a scale attribute generates different random functions and thus output textures. Therefore, by controlling a single scale variable, different uv-coordinate to texture mappings can be easily created.
                            Further control is given by explicitly defining the amplitude and frequency of the consequtively added waves so that the user can control the overall apperance and distribution of textures generated.
                            More details regarding the algorithm and the following implementation can be found here: <a href="https://web.archive.org/web/20160530124230/http://freespace.virgin.net/hugo.elias/models/m_perlin.htm">reference</a>. 
                            For a slightly different treatment of Perlin noise and for a better overview of noise functions in procedural texture generation, refer to <a href="https://www.pbr-book.org/3ed-2018/Texture/Noise#fragment-TextureMethodDefinitions-10">PBR</a>.
                            <br><br>
                            My implementation of Perlin noise is controlled by a scale factor, persistence value, number of octaves, as well as an optional scaling factor for RGB colour output as seen in the .xml scene definition snippet below.
                                <pre><xmp><!-- Sphere -->
 <mesh type="sphere">
    <point name="center" value="4.25,2.7,0"/>
    <float name="radius" value="2"/>
    <bsdf type="diffuse">
        <texture type="Procedural_perlin_texture" name="albedo">
            <integer name= "scale" value = "10"/>
            <float name= "persistence" value = "0.5"/>
            <integer name= "octaves" value = "8"/>
            <vector name = "color_scale" value = "10,1,1"/>
        </texture>
    </bsdf>
</mesh></xmp></pre>
                            Number of octaves refers to the number of wave functions added together to generate the final texture. The higher the number of octaves, the more high frequency waves are added. 
                            Each octave, or individual wave, is defined by a frequency and amplitude. The frequency and amplitude are given by the following formula:
                            <br><br>
                            <center><pre>frequency = std::pow(2,i); amplitude = std::pow(persistence,i);</pre></center>
                            Where <i>i</i> is the octave number and <i>persistence</i> is a term that modulates the amplitude at each octave. Higher octaves have higher frequencies but lower amplitudes.
                            Higher frequencies help in rendering fine details, like boundaries and edges in the generated texture patterns.  
                            
                            The scale factor controls the pseudo-random number generator directly. I map uv-coordinates from the [0,1] domain to the interval [0, scale_factor].
                            These coordinates, modulated by the frequency at each octave, are the input to the noise function which deterministically generates random numbers on the interval [-1,1]. 
                                <br><br><pre> <xmp>// Noise function
float Noise(const float x, const float y){
int n;
n = x + y * 57;
n = (n << 13) ^ n;
float value = (1.0 - ((n * ((n * n * 15731) + 789221) + 1376312589) & 0x7fffffff) / 1073741824.0);
return (1.0 - ((n * ((n * n * 15731) + 789221) + 1376312589) & 0x7fffffff) / 1073741824.0);
}</xmp></pre>
                            
                            The output of the random number generator is then used to interpolate a color value after summing the contribution of each octave wave. I interpolate with linear and cosine interpolation to create smooth texture transitions in the output color. The entire code and further implementation details can be seen below. 
                            <!--code--> 
                            <div class="col-md-14" pre>
                                <input type="button" name="answer" value="procedural_perlin_textures.cpp" onclick='showDiv(name = "myDIV3")'/>
                            </div>
                               <div class="col-md-14">
                                    <div id="myDIV3"  style="display:none;" class="" > 
                                        <pre> 
                <xmp>/*
Procedural Perlin Noise Textures
by: Matias Turkulainen
*/

#include <nori/texture.h>
#include <filesystem/resolver.h>

NORI_NAMESPACE_BEGIN

class Procedural_perlin_texture : public Texture<Color3f> {
public:

    Procedural_perlin_texture(const PropertyList &props){
        m_persistence = props.getFloat("persistence", 0.5);
        m_octaves = props.getInteger("octaves", 8);
        m_scale = props.getInteger("scale", 10);
        m_color_scale = props.getVector3("color_scale", Vector3f(1));
    }
    
    Color3f eval(const Point2f & uv) {
        float total = 0.0;
        float p = m_persistence;
        int n = m_octaves - 1;

        int frequency;
        float amplitude;
        for (int i = 0; i < n; i++)
        {
            frequency = std::pow(2,i);
            amplitude = std::pow(p,i);
            total += amplitude * InterpolatedNoise(uv.x() * frequency * m_scale, uv.y() * frequency * m_scale);
            if (total >= 255){
                break;
            }
        }
        if (total >=0.0){
            return Color3f(total *m_color_scale.x(), total *m_color_scale.y(), total *m_color_scale.z());
        } else {return Color3f(0,0,0);}
    }

    float Noise(const float x, const float y){
        // Returns float in interval [-1,1]
        int n;
        n = x + y * 57;
        n = (n << 13) ^ n;
        float value = (1.0 - ((n * ((n * n * 15731) + 789221) +  1376312589) & 0x7fffffff) / 1073741824.0);
        return (1.0 - ((n * ((n * n * 15731) + 789221) +  1376312589) & 0x7fffffff) / 1073741824.0);
    }

    float SmoothedNoise(const float x, const float y){
        // Gradient smoothing
        float corners;
        float sides;
        float center;

        corners = ( Noise(x-1, y-1)+Noise(x+1, y-1)+Noise(x-1, y+1)+Noise(x+1, y+1) ) / 16;
        sides   = ( Noise(x-1, y)  +Noise(x+1, y)  +Noise(x, y-1)  +Noise(x, y+1) ) /  8;
        center  =  Noise(x, y) / 4;

        //std::cout<<"Smoothed noise is: "<<corners + sides + center<<std::endl;
        return corners + sides + center;
    }

    float InterpolatedNoise(const float x, const float y){
        // Grid computation
        int integer_X    = int(x);
        float fractional_X = x - integer_X;

        int integer_Y    = int(y);
        float fractional_Y = y - integer_Y;
        float v1 = SmoothedNoise(integer_X,     integer_Y);
        float v2 = SmoothedNoise(integer_X + 1, integer_Y);
        float v3 = SmoothedNoise(integer_X,     integer_Y + 1);
        float v4 = SmoothedNoise(integer_X + 1, integer_Y + 1);

        float i1 = Interpolate(v1 , v2 , fractional_X);
        float i2 = Interpolate(v3 , v4 , fractional_X);

        return Interpolate(i1 , i2 , fractional_Y);

    }

    float Interplate_linar (const float a, const float b, const float x){
        // Linear interpolation
        return  a*(1-x) + b*x;
    }

    float Interpolate(float a, float b, float x){
        // Cosine interpolation
        double ft = x * M_PI;
        double f = (1 - cos(ft)) * 0.5;
        return  a*(1-f) + b*f;
    }


    std::string toString() const {
        return tfm::format(
                "Procedural_perlin_texture[\n"
                "  m_name = %s\n"
                "]",
                m_persistence,
                m_octaves,
                m_scale
                );
    }

protected:
    int m_octaves;
    float m_persistence;
    int m_scale;
    Vector3f m_color_scale;
};

NORI_REGISTER_CLASS(Procedural_perlin_texture, "Procedural_perlin_texture")
NORI_NAMESPACE_END
                    
                </xmp>
                                        </pre>
                                    </div>
                               </div>
                        </p>
        
                        <div class="col-md-6"> 
                        <div style="position:relative;">
                            <div class="twentytwenty-container">
                                <img src="images/textures/perlin/scale10_octaves2_per0.5.png" alt="Octaves 2" class="img-responsive" >
                                <img src="images/textures/perlin/scale10_octaves16_per0.1.png" alt="Octaves 16 Persistence 0.1" class="img-responsive%;" >
                                <img src="images/textures/perlin/scale10_octaves4_per0.5.png" alt="Octaves 4" class="img-responsive%;" >
                                <img src="images/textures/perlin/scale10_octaves8_per0.5.png" alt="Octaves 8" class="img-responsive%;" >
                            </div>
                            <pre><xmp > Scale = 10, Persistence = 0.5 </xmp></pre> 
                        </div>
                        </div>
        
                        <div class="col-md-6">
                        <div style="position:relative;">
                            <div class="twentytwenty-container">
                                <img src="images/textures/perlin/scale100_octaves2_per0.5.png" alt="Octaves 2" class="img-responsive" >
                                <img src="images/textures/perlin/scale100_octaves16_per0.1.png" alt="Octaves 16 Persistence 0.1" class="img-responsive%;" >
                                <img src="images/textures/perlin/scale100_octaves4_per0.5.png" alt="Octaves 4" class="img-responsive%;" >
                                <img src="images/textures/perlin/scale100_octaves8_per0.5.png" alt="Octaves 8" class="img-responsive%;" >
                            </div> 
                            <pre><xmp > Scale = 100, Persistence = 0.5 </xmp></pre>
                        </div>
                        </div>

                        <div class="col-md-14 col-md-offset-0">
                            <p class="text-justify">
                                I also explored interpolation techniques for smoother texture mapping. Linear interpolation lost details at edges and corners compared to higher order interpolation, like cosine interpolation. 
                            </p>

                        </div>
                        <div class="col-md-8 col-md-offset-2">
                            <div class="twentytwenty-container">
                                <img src="images/textures/perlin/linear_interpolation.png" alt="Linear interpolation" class="img-responsive" >
                                <img src="images/textures/perlin/cosine_interpolation.png" alt="Cosine interpolation" class="img-responsive%;" >
                            </div> 
                            <pre><xmp > Linear vs Cosine interpolation, Scale = 50</xmp></pre>
                        </div>
                    </div>
                    
                </div>
         
        
        <!--Cluster--> 
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <h3>
                    Rendering on a High Performance Cluster
                </h3>
                <p class="text-justify">
                    Some of the images seen already required over an hour to render on a M1 Macbook. 
                    To accelerate debugging and high resolution image creation, I attempted to compile Nori on a high performance cluster: <a href="https://scicomp.ethz.ch/wiki/Euler">Euler</a>.
                    To achieve this, some modifications were required. The major dependency on NanoGui was removed and a new main script was created that directly renders images bypassing previous GUI implementation steps.
                    Redundant graphical dependencies were also removed from CMakeLists.txt file.    
                </p>

                <div class="col-md-16 col-md-offset-0" >
                    <input type="button" name="answer" value="CMakeLists.txt" onclick='showDiv(name = "myDIV9")' />
                </div>
                <div class="col-md-16 col-md-offset-0">
                    <div id="myDIV9"  style="display:none;" class="" > 
        <pre><xmp># Cluster Nori 
# by Matias Turkulainen
# This is the main CMake build file used to compile Nori Cluster Version
cmake_minimum_required (VERSION 2.8)
project("nori")

# This file included below takes care of compiling dependencies
# and setting compiler flags on different platforms
include("CMakeConfig.txt")

include_directories(ext)

# The following lines build the main executable. If you add a source
# code file to Nori, be sure to include it in this list.
add_executable(nori

    # Header files
    include/nori/cluster.h
    include/nori/bbox.h
    include/nori/bitmap.h
    include/nori/block.h
    include/nori/bsdf.h
    include/nori/bvh.h
    include/nori/camera.h
    include/nori/color.h
    include/nori/common.h
    include/nori/dpdf.h
    include/nori/frame.h
    include/nori/cluster.h
    include/nori/integrator.h
    include/nori/emitter.h
    include/nori/kdtree.h
    include/nori/mesh.h
    include/nori/object.h
    include/nori/parser.h
    include/nori/proplist.h
    include/nori/photon.h
    include/nori/ray.h
    include/nori/render.h
    include/nori/rfilter.h
    include/nori/sampler.h
    include/nori/scene.h
    include/nori/shape.h
    include/nori/texture.h
    include/nori/timer.h
    include/nori/transform.h
    include/nori/vector.h
    include/nori/warp.h

    # Source code files
    src/cluster.cpp
    src/main_cluster.cpp
    src/normals.cpp
    src/bitmap.cpp
    src/block.cpp
    src/bvh.cpp
    src/chi2test.cpp
    src/common.cpp
    src/consttexture.cpp
    src/checkerboard.cpp
    src/diffuse.cpp
    src/cluster.cpp
    src/independent.cpp
    src/mesh.cpp
    src/obj.cpp
    src/object.cpp
    src/parser.cpp
    src/perspective.cpp
    src/proplist.cpp
    src/render.cpp
    src/rfilter.cpp
    src/scene.cpp
    src/shape.cpp
    src/ttest.cpp
    src/warp.cpp
    src/microfacet.cpp
    src/photon.cpp
    src/mirror.cpp
    src/dielectric.cpp
    src/photonmapper.cpp
    src/sphere.cpp
    src/arealight.cpp
)

# The following lines build the warping test application
#add_executable(warptest
#  include/nori/warp.h
#  src/warp.cpp
#  src/warptest.cpp
#  src/microfacet.cpp
#  src/object.cpp
#  src/proplist.cpp
#  src/common.cpp
#)

#add_executable(tonemapper
#        include/nori/bitmap.h
#        src/bitmap.cpp
#        src/common.cpp
#        src/hdrToLdr.cpp)

# Nori depends on some libraries created in CMakeConfig.txt. The following two
# lines ensure that Nori is built *after* those libraries have been created.
add_dependencies(nori OpenEXR_p)
# add_dependencies(nori nanogui_p)
add_dependencies(nori tbb_p)
add_dependencies(nori pugixml)
#add_dependencies(warptest nori)
#add_dependencies(tonemapper nori)

# Link to dependency libraries
target_link_libraries(nori ${extra_libs})
#target_link_libraries(warptest ${extra_libs})
#target_link_libraries(tonemapper ${extra_libs})

# vim: set et ts=2 sw=2 ft=cmake nospell:
            
        </xmp></pre>
        </div>


        <div class="col-md-16 col-md-offset-0" >
            <input type="button" name="answer" value="main_cluster.cpp" onclick='showDiv(name = "myDIV10")' />
        </div>
        <div class="col-md-16 col-md-offset-0">
            <div id="myDIV10"  style="display:none;" class="" > 
<pre><xmp>/*
Cluster version of Nori
by: Matias Turkulainen
*/

#include <nori/parser.h>
#include <nori/scene.h>
#include <nori/camera.h>
#include <nori/block.h>
#include <nori/timer.h>
#include <nori/bitmap.h>
#include <nori/sampler.h>
#include <nori/integrator.h>
#include <tbb/parallel_for.h>
#include <tbb/blocked_range.h>
#include <tbb/task_scheduler_init.h>
#include <filesystem/resolver.h>
#include <thread>

#include <nori/cluster.h>

using namespace nori;


static void renderBlock(const Scene *scene, Sampler *sampler, ImageBlock &block) {
    const Camera *camera = scene->getCamera();
    const Integrator *integrator = scene->getIntegrator();

    Point2i offset = block.getOffset();
    Vector2i size  = block.getSize();

    /* Clear the block contents */
    block.clear();

    /* For each pixel and pixel sample sample */
    for (int y=0; y<size.y(); ++y) {
        for (int x=0; x<size.x(); ++x) {
            for (uint32_t i=0; i<sampler->getSampleCount(); ++i) {
                Point2f pixelSample = Point2f((float) (x + offset.x()), (float) (y + offset.y())) + sampler->next2D();
                Point2f apertureSample = sampler->next2D();

                /* Sample a ray from the camera */
                Ray3f ray;
                Color3f value = camera->sampleRay(ray, pixelSample, apertureSample);

                /* Compute the incident radiance */
                value *= integrator->Li(scene, sampler, ray);

                /* Store in the image block */
                block.put(pixelSample, value);
            }
        }
    }
}

static void render(Scene *scene, const std::string &filename) {
    const Camera *camera = scene->getCamera();
    Vector2i outputSize = camera->getOutputSize();
    scene->getIntegrator()->preprocess(scene);

    /* Create a block generator (i.e. a work scheduler) */
    BlockGenerator blockGenerator(outputSize, NORI_BLOCK_SIZE);

    /* Allocate memory for the entire output image and clear it */
    ImageBlock result(outputSize, camera->getReconstructionFilter());
    result.clear();


    /* Do the following in parallel and asynchronously */
    std::thread render_thread([&] {
        tbb::task_scheduler_init init(-1);
        
        cout << "Rendering .. ";
        cout.flush();
        Timer timer;

        tbb::blocked_range<int> range(0, blockGenerator.getBlockCount());

        auto map = [&](const tbb::blocked_range<int> &range) {
            /* Allocate memory for a small image block to be rendered
                by the current thread */
            ImageBlock block(Vector2i(NORI_BLOCK_SIZE),
                camera->getReconstructionFilter());

            /* Create a clone of the sampler for the current thread */
            std::unique_ptr<Sampler> sampler(scene->getSampler()->clone());

            for (int i=range.begin(); i<range.end(); ++i) {
                /* Request an image block from the block generator */
                blockGenerator.next(block);

                /* Inform the sampler about the block to be rendered */
                sampler->prepare(block);

                /* Render all contained pixels */
                renderBlock(scene, sampler.get(), block);

                /* The image block has been processed. Now add it to
                    the "big" block that represents the entire image */
                result.put(block);
            }
        };

        /// Uncomment the following line for single threaded rendering
        // map(range);

        /// Default: parallel rendering
        tbb::parallel_for(range, map);

        cout << "done. (took " << timer.elapsedString() << ")" << endl;
    });


    /* Shut down the user interface */
    render_thread.join();

    /* Now turn the rendered image block into
        a properly normalized bitmap */
    std::unique_ptr<Bitmap> bitmap(result.toBitmap());

    /* Determine the filename of the output bitmap */
    std::string outputName = filename;
    size_t lastdot = outputName.find_last_of(".");
    if (lastdot != std::string::npos)
        outputName.erase(lastdot, std::string::npos);

    /* Save using the OpenEXR format */
    bitmap->saveEXR(outputName);

    /* Save tonemapped (sRGB) output using the PNG format */
    bitmap->savePNG(outputName);
}



int main(int argc, char **argv) {
    
    try {
        
        ImageBlock block(Vector2i(720, 720), nullptr);
        NoriCluster *cluster = new NoriCluster(block);

        // if file is passed as argument, handle it
        if (argc == 2) {
            std::string filename = argv[1];
            filesystem::path path(filename);

            if (path.extension() == "xml") {
                /* Render the XML scene file */
                    getFileResolver()->prepend(path.parent_path());

                std::unique_ptr<NoriObject> root(loadFromXML(argv[1]));

                /* When the XML root object is a scene, start rendering it .. */
                if (root->getClassType() == NoriObject::EScene)
                    render(static_cast<Scene *>(root.get()), argv[1]);

            } else {
                cerr << "Error: unknown file \"" << filename
                << "\", expected an extension of type .xml or .exr" << endl;
            }
        }

    } catch (const std::exception &e) {
        cerr << "Fatal error: " << e.what() << endl;
        return -1;
    }
    return 0;
}
    

</xmp></pre>
</div>
</div>

<div class="col-md-12 col-md-offset-0">
    <div class="twentytwenty-container">
        <img src="images/cluster.png" alt="ETH Euler Cluster" class="img-responsive" >
    </div> 
    <pre>Terminal output rendering on the ETH Euler Cluster (without making a batch job)</pre>
</div>

</div>
</div>
        
    


        <!-- ADVANCED-->
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <br>
                <h1>
                    Advanced Features
                </h1>
                <p class="text-justify"> 
                    ... Whew, almost there ... 
                </p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <br>
                <h3>
                    Environmental Map Emitter
                </h3>
                <p class="text-justify">
                    Image based lighting refers to using a textured image as the envrionmental illumination source in a scene. 
                    This can be viewed as either an infinite area light that surrounds the entire scene or as a sphere that casts light into the scene from every direction. 
                    Images are favourable since high resolution images are able to capture high dynamic range effects and subtleties that are difficult to mimic with point lights, area emitters, or other light sources in a renderer.
                    This approach is, unfortunately, very expensive since importance sampling of direct light sources is no longer effective since we effecively have an infinite area to sample. The <a href="https://www.pbr-book.org/3ed-2018/Light_Transport_I_Surface_Reflection/The_Light_Transport_Equation">light transport equation</a> 

                <div class="row">
                <div class="col-md-2 col-lg-2 center">
                
                </div>
                <div class="col-md-10 col-lg-8">
                <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="60.759ex" height="5.843ex" style="vertical-align: -2.338ex;" viewBox="0 -1508.9 26160 2515.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                <title id="MathJax-SVG-1-Title">StartLayout 1st Row 1st Column upper L Subscript normal o Superscript Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal o Baseline right-parenthesis 2nd Column equals upper L Subscript normal e Superscript Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal o Baseline right-parenthesis plus integral Underscript script upper S squared Endscripts f Subscript Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal o Baseline comma omega Subscript normal i Baseline right-parenthesis upper L Subscript normal i Superscript Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript normal i Baseline right-parenthesis StartAbsoluteValue cosine theta Subscript normal i Baseline EndAbsoluteValue normal d omega Subscript normal i Baseline period EndLayout</title>
                <defs aria-hidden="true">
                <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNSIZE1-222B" d="M943 1268c0 -35 -25 -50 -49 -50c-23 0 -48 16 -48 49c0 25 17 47 50 49c-4 4 -29 23 -60 23c-39 0 -73 -129 -85 -178c-34 -129 -71 -329 -108 -542c-54 -321 -119 -640 -196 -956c-71 -290 -128 -524 -280 -524c-61 0 -111 42 -111 93c0 35 25 50 49 50 c23 0 48 -16 48 -49c0 -25 -17 -47 -49 -49c0 0 25 -23 61 -23c81 0 127 188 145 261c33 139 62 306 88 459c110 654 246 1156 249 1167c55 204 111 313 187 313c55 0 109 -39 109 -93Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-53" d="M499 186c0 -110 -80 -208 -197 -208c-89 0 -153 36 -184 70c-33 -53 -36 -57 -36 -57c-7 -11 -8 -13 -15 -13c-11 0 -11 7 -11 24v200c0 18 0 25 13 25c3 0 11 0 12 -10c1 -36 4 -100 62 -154c53 -49 129 -54 158 -54c84 0 134 72 134 143c0 33 -10 66 -31 92 c-28 37 -58 44 -85 51c-70 17 -121 29 -132 33c-78 27 -131 100 -131 183c0 106 84 194 195 194c89 0 130 -41 160 -70l35 57c7 12 8 13 15 13c11 0 11 -7 11 -24v-201c0 -19 0 -24 -13 -24c-11 0 -11 6 -12 12c-6 45 -28 209 -195 209c-78 0 -132 -61 -132 -131 c0 -58 39 -112 101 -127l128 -31c84 -20 150 -102 150 -202Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-7C" d="M159 -230c0 -11 -9 -20 -20 -20s-20 9 -20 20v960c0 11 9 20 20 20s20 -9 20 -20v-960Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-63" d="M415 119c0 -10 -32 -130 -166 -130c-116 0 -215 99 -215 227c0 124 92 232 217 232c77 0 153 -39 153 -107c0 -30 -20 -47 -46 -47c-28 0 -46 20 -46 46c0 13 6 43 47 46c-35 36 -98 37 -107 37c-53 0 -135 -42 -135 -205c0 -161 88 -204 141 -204c37 0 102 12 131 105 c2 6 4 10 13 10c3 0 13 0 13 -10Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
                <path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
                </defs>
                <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                <g transform="translate(167,0)">
                <g transform="translate(-11,0)">
                <g transform="translate(0,25)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="963" y="-213"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1135" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1524" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2081" y="0"></use>
                <g transform="translate(2526,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3602" y="0"></use>
                </g>
                </g>
                <g transform="translate(4259,0)">
                <g transform="translate(0,25)">
                 <use xlink:href="#E1-LATINMODERNMAIN-3D" x="0" y="0"></use>
                <g transform="translate(1056,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-65" x="963" y="-213"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-28" x="1095" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1485" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2041" y="0"></use>
                <g transform="translate(2486,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3563" y="0"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-2B" x="5231" y="0"></use>
                <g transform="translate(6232,0)">
                 <use xlink:href="#E1-LATINMODERNSIZE1-222B" x="0" y="0"></use>
                <g transform="translate(574,-898)">
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-53" x="0" y="0"></use>
                 <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="685" y="483"></use>
                </g>
                </g>
                <g transform="translate(7824,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-28" x="8581" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-70" x="8971" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="9527" y="0"></use>
                <g transform="translate(9973,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="11049" y="0"></use>
                <g transform="translate(11494,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-29" x="12414" y="0"></use>
                <g transform="translate(12970,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="963" y="-213"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-28" x="978" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-70" x="1367" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1924" y="0"></use>
                <g transform="translate(2369,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-29" x="3289" y="0"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="16815" y="0"></use>
                <g transform="translate(17094,0)">
                 <use xlink:href="#E1-LATINMODERNMAIN-63"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-6F" x="444" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-73" x="945" y="0"></use>
                </g>
                <g transform="translate(18600,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="663" y="-213"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-7C" x="19366" y="0"></use>
                 <use xlink:href="#E1-LATINMODERNMAIN-64" x="19811" y="0"></use>
                <g transform="translate(20368,0)">
                 <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                 <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
                </g>
                 <use xlink:href="#E1-LATINMODERNMAIN-2E" x="21287" y="0"></use>
                </g>
                </g>
                </g>
                </g>
                </svg>
                </div>
                </div>
                </div>
                
                    must be approximated by Monte Carlo Sampling and a suitable importance sampling technique must be implemented which saves from integrating over the entire sphere for all scene intersection points.
                    A sampling technique proportional to the outgoing illumination, or pixel wise intensity, on the environment map would help in lowering the variance on the incident radiance term.
                    The main idea is to define a probability distribution on the pixel domain based on the environment map's luminance distribution (pixel wise intensities) and transforming this onto a probability distribution on a sphere. 
                    Then, the spherical distribution can be used to define a probability distribution on incident solid angles of scene intersection points. 
                    With this method, sampling incident solid angle directions proportional to the intensity of the environment map pixel intensities will greatly outperform and decrease the variance compared to naive uniform sampling of incident directions.
                    <br><br>

                    Below I walk through the implementation details for image based lighting in Nori. I closely follow the implementation illustrated in the paper <a href="https://libraopen.lib.virginia.edu/downloads/nv935289d">Monte Carlo Rendering with Natural Illumination</a>,
                    especially their pseudocode for precomputation, 1D and 2D random sampling. I also took inspiration from the environment map implementation in the <a href="https://github.com/mitsuba-renderer/mitsuba/blob/master/src/emitters/envmap.cpp">Mitsuba</a> renderer.

                    <h4>
                        Implementation Details
                    </h4>
                    The first step in the algorithm is to precompute a piecewise-constant 2D distribution on the pixel domain proportional to the chosen environement map luminance or pixel wise intensitites f(x,y).
                    The luminance is simply computed as the norm of the pixel RGB channels. 
                    The joint distribution of pixel luminance p(x,y) is then given by: <br><br>
                    <div class="row">
                        <div class="col-md-2 col-lg-2 center">
                        </div>
                        <div class="col-md-10 col-lg-8">
                            <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="55.232ex" height="6.843ex" style="vertical-align: -3.005ex; margin-left: -0.073ex;" viewBox="-31.5 -1652.5 23780.5 2946.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                                <title id="MathJax-SVG-1-Title">p left-parenthesis u comma v right-parenthesis equals StartFraction f left-parenthesis u comma v right-parenthesis Over integral integral f left-parenthesis u comma v right-parenthesis normal d u normal d v EndFraction equals StartFraction f left-bracket u overTilde comma v overTilde right-bracket Over 1 slash left-parenthesis n Subscript u Baseline n Subscript v Baseline right-parenthesis sigma-summation Underscript i Endscripts sigma-summation Underscript j Endscripts f left-bracket u Subscript i Baseline comma v Subscript j Baseline right-bracket EndFraction period</title>
                                <defs aria-hidden="true">
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D465" d="M527 376c0 -40 -32 -58 -54 -58c-27 0 -38 19 -38 35c0 24 20 49 48 54c-21 13 -45 13 -50 13c-70 0 -93 -92 -99 -118l-34 -137c-11 -44 -17 -66 -17 -88c0 -34 16 -66 55 -66c32 0 100 24 133 131c2 7 4 11 13 11c3 0 12 0 12 -10c0 -25 -57 -154 -160 -154 c-60 0 -96 39 -108 76c-3 -6 -39 -76 -105 -76c-44 0 -94 20 -94 66c0 32 25 58 55 58c15 0 37 -8 37 -35c0 -28 -22 -49 -47 -54c21 -13 44 -13 50 -13c44 0 79 42 95 104c37 140 54 207 54 238c0 58 -35 67 -54 67c-34 0 -100 -25 -134 -131c-2 -9 -5 -11 -13 -11 c0 0 -12 0 -12 10c0 25 57 154 161 154c29 0 83 -10 108 -76c12 23 47 76 105 76c34 0 93 -14 93 -66Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-222B" d="M609 722c0 -30 -22 -43 -42 -43c-19 0 -41 13 -41 42c0 14 8 37 37 41c-22 19 -53 21 -63 21c-45 0 -79 -25 -93 -209l-19 -249c-8 -111 -44 -402 -57 -454c-22 -90 -70 -177 -165 -177c-60 0 -110 35 -110 83c0 30 22 43 42 43c19 0 41 -13 41 -42c0 -14 -8 -37 -37 -41 c21 -18 51 -21 64 -21c57 0 93 45 106 209l19 249c9 121 45 403 57 458c17 76 56 173 151 173c60 0 110 -35 110 -83Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
                                    </defs>
                                    <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="893" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1465" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1910" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-29" x="2396" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3063" y="0"></use>
                                    <g transform="translate(3841,0)">
                                    <g transform="translate(397,0)">
                                    <rect stroke="none" width="6790" height="60" x="0" y="220"></rect>
                                    <g transform="translate(1977,768)">
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-28" x="552" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="942" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1514" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1959" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-29" x="2445" y="0"></use>
                                    </g>
                                    <g transform="translate(60,-826)">
                                    <use xlink:href="#E1-LATINMODERNMAIN-222B" x="0" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-222B" x="498" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="1331" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-28" x="1883" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="2273" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2845" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="3290" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-29" x="3776" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-64" x="4332" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="4888" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-64" x="5628" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="6184" y="0"></use>
                                </g>
                                </g>
                                </g>
                                </svg>
                                </div>
                        </div>
                        </div>
                    
                        <br>
                    Sampling this distribution is not straightforward since the distributions p(x) and p(y) are not independent. Instead, we separate the joint distribution using the conditional property and marginalization. 
                    The marginal density p(y) can be expressed as: 

                         <!--second equation--> 
                        <div class="row">
                            <div class="col-md-2 col-lg-2 center">
                            </div>
                            <div class="col-md-10 col-lg-8">
                                <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.514ex" height="6.343ex" style="vertical-align: -2.505ex; margin-left: -0.073ex;" viewBox="-31.5 -1652.5 17874 2730.8" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                                    <title id="MathJax-SVG-1-Title">p left-parenthesis v right-parenthesis equals integral p left-parenthesis u comma v right-parenthesis normal d u equals StartFraction left-parenthesis 1 slash n Subscript u Baseline right-parenthesis sigma-summation Underscript i Endscripts f left-bracket u Subscript i Baseline comma v overTilde right-bracket Over upper I Subscript f Baseline EndFraction period</title>
                                    <defs aria-hidden="true">
                                        <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M490 404c0 -7 0 -9 -4 -23l-96 -382c-28 -113 -131 -204 -234 -204c-62 0 -106 37 -106 87c0 49 33 65 56 65c10 0 37 -4 37 -35c0 -19 -10 -32 -20 -41c-14 -12 -27 -12 -43 -12c17 -39 62 -42 76 -42c46 0 84 29 110 63c40 53 52 102 65 154c-28 -28 -62 -45 -101 -45 c-59 0 -122 30 -122 119c0 47 18 104 58 210c7 19 17 45 17 70c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -20 -4 -31 -20 -72c-34 -88 -51 -150 -51 -196c0 -37 11 -81 62 -81 c66 0 109 70 113 85l45 180l20 80c4 18 12 49 14 54c9 15 25 21 35 21c15 0 29 -9 29 -27Z"></path>

                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNSIZE1-222B" d="M943 1268c0 -35 -25 -50 -49 -50c-23 0 -48 16 -48 49c0 25 17 47 50 49c-4 4 -29 23 -60 23c-39 0 -73 -129 -85 -178c-34 -129 -71 -329 -108 -542c-54 -321 -119 -640 -196 -956c-71 -290 -128 -524 -280 -524c-61 0 -111 42 -111 93c0 35 25 50 49 50 c23 0 48 -16 48 -49c0 -25 -17 -47 -49 -49c0 0 25 -23 61 -23c81 0 127 188 145 261c33 139 62 306 88 459c110 654 246 1156 249 1167c55 204 111 313 187 313c55 0 109 -39 109 -93Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45B" d="M571 143c0 -8 -37 -154 -131 -154c-47 0 -82 35 -82 82c0 11 1 23 10 46c16 43 65 171 65 233c0 33 -9 70 -54 70c-95 0 -148 -91 -163 -122l-13 -50c-5 -23 -11 -45 -17 -67l-22 -90c-6 -25 -18 -72 -19 -74c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43 l58 231c13 52 16 63 16 84c0 33 -11 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 4 14 63 30 97c10 18 29 57 75 57s87 -31 92 -87c17 23 66 87 156 87c72 0 115 -40 115 -107c0 -57 -42 -167 -61 -220c-9 -22 -18 -46 -18 -71 c0 -23 7 -33 24 -33c49 0 82 56 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNOPERATORS-2211" d="M999 -1l-86 -249h-829c-18 0 -27 0 -27 11c0 4 1 6 9 16l355 439l-365 502c0 31 1 32 28 32h829l86 -234h-25c-70 187 -300 194 -414 194h-396l325 -446c6 -9 7 -10 7 -14s-2 -7 -9 -16l-347 -429h425c147 0 216 24 232 29c85 29 152 90 177 165h25Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-303" d="M-79 734c0 -1 0 -1 -1 -2c-8 -62 -19 -103 -58 -122c-14 -7 -30 -10 -45 -10c-31 0 -63 12 -92 25c-22 10 -45 22 -67 22c-8 0 -17 -2 -25 -6c-27 -13 -52 -32 -58 -77c-1 -5 -6 -10 -12 -10s-12 5 -12 12c0 1 0 1 1 2c8 62 19 103 58 122c14 7 30 10 45 10 c31 0 63 -12 92 -25c22 -10 45 -22 67 -22c8 0 17 2 25 6c27 13 52 32 58 77c1 5 6 10 12 10s12 -5 12 -12Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
                                    </defs>
                                    <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="893" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-29" x="1378" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2045" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNSIZE1-222B" x="3102" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="4212" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-28" x="4715" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="5105" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-2C" x="5677" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="6122" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-29" x="6608" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-64" x="7164" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="7721" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-3D" x="8571" y="0"></use>
                                    <g transform="translate(7000,0)">
                                    <g transform="translate(0,0)">
                                    <rect stroke="none" width="4696" height="60" x="3000" y="220"></rect>
                                    <g transform="translate(60,814)">
                                    <g transform="translate(3051,0)">
                                     <use xlink:href="#E1-LATINMODERNOPERATORS-2211" x="0" y="0"></use>
                                    </g>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="4619" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-5B" x="5171" y="0"></use>
                                    <g transform="translate(5450,0)">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
                                     <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D456" x="809" y="-213"></use>
                                    </g>
                                     <use xlink:href="#E1-LATINMODERNMAIN-2C" x="6367" y="0"></use>
                                    <g transform="translate(6812,0)">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-303" x="466" y="-3"></use>
                                    </g>
                                     <use xlink:href="#E1-LATINMODERNMAIN-5D" x="7297" y="0"></use>
                                    </g>
                                    <g transform="translate(5000,-704)">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
                                     <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="622" y="-219"></use>
                                    </g>
                                    </g>
                                    </svg>
                                    </div>
                            </div>
                        </div>
                        <br>
                    This allows us to define the distribution of the remaining dimension as the following conditional distribution: 
                    <br><br>    
                    <!--third equation--> 
                        <div class="row">
                            <div class="col-md-2 col-lg-2 center">
                            </div>
                            <div class="col-md-10 col-lg-8">
                                <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="30.535ex" height="6.509ex" style="vertical-align: -2.671ex; margin-left: -0.073ex;" viewBox="-31.5 -1652.5 13147.1 2802.6" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                                    <title id="MathJax-SVG-1-Title">p left-parenthesis u vertical-bar v right-parenthesis equals StartFraction p left-parenthesis u comma v right-parenthesis Over p left-parenthesis v right-parenthesis EndFraction equals StartFraction f left-bracket u overTilde comma v overTilde right-bracket slash upper I Subscript f Baseline Over p left-bracket v overTilde right-bracket EndFraction period</title>
                                    <defs aria-hidden="true">
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-7C" d="M159 -230c0 -11 -9 -20 -20 -20s-20 9 -20 20v960c0 11 9 20 20 20s20 -9 20 -20v-960Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D466" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D453" d="M552 636c0 -38 -29 -60 -55 -60c-19 0 -37 12 -37 35c0 15 10 50 54 54c-19 18 -45 18 -49 18c-21 0 -38 -15 -47 -34c-6 -12 -20 -83 -24 -104c-11 -58 -10 -56 -21 -114h83c17 0 27 0 27 -11c0 -20 -10 -20 -30 -20h-86l-60 -317c-1 -7 -24 -128 -56 -191 c-18 -38 -58 -97 -113 -97c-41 0 -85 24 -85 69c0 38 29 60 55 60c19 0 37 -12 37 -35c0 -15 -9 -51 -55 -54c19 -18 44 -18 48 -18c52 0 69 91 87 188l75 395h-66c-19 0 -28 0 -28 12c0 19 11 19 30 19h69c24 126 27 136 33 157c30 99 93 117 127 117c41 0 87 -23 87 -69Z"></path>

                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D456" d="M284 625c0 -30 -30 -53 -53 -53c-24 0 -38 17 -38 36c0 27 27 53 54 53c23 0 37 -16 37 -36zM293 143c0 -9 -37 -154 -131 -154c-48 0 -82 35 -82 82c0 21 13 54 23 80c16 43 61 159 69 185c4 10 11 31 11 52c0 32 -17 32 -25 32c-34 0 -74 -30 -101 -124 c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -13 -53c-10 -27 -10 -29 -22 -58l-39 -105c-23 -61 -29 -75 -29 -100c0 -23 7 -33 24 -33c51 0 84 61 102 124c5 15 5 18 15 18c3 0 12 0 12 -10Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-5B" d="M256 -230c0 -11 -9 -20 -20 -20h-122v1000h122c11 0 20 -9 20 -20s-9 -20 -20 -20h-82v-920h82c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-303" d="M-79 734c0 -1 0 -1 -1 -2c-8 -62 -19 -103 -58 -122c-14 -7 -30 -10 -45 -10c-31 0 -63 12 -92 25c-22 10 -45 22 -67 22c-8 0 -17 -2 -25 -6c-27 -13 -52 -32 -58 -77c-1 -5 -6 -10 -12 -10s-12 5 -12 12c0 1 0 1 1 2c8 62 19 103 58 122c14 7 30 10 45 10 c31 0 63 -12 92 -25c22 -10 45 -22 67 -22c8 0 17 2 25 6c27 13 52 32 58 77c1 5 6 10 12 10s12 -5 12 -12Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-5D" d="M164 -250h-122c-11 0 -20 9 -20 20s9 20 20 20h82v920h-82c-11 0 -20 9 -20 20s9 20 20 20h122v-1000Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2F" d="M445 730c0 -2 0 -5 -1 -7l-349 -960c-3 -8 -10 -13 -19 -13c-11 0 -20 9 -20 20c0 2 0 5 1 7l349 960c3 8 10 13 19 13c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43C" d="M497 671c0 -19 -8 -19 -32 -19c-79 0 -82 -10 -91 -46l-134 -533c-2 -7 -4 -15 -4 -23c0 -11 4 -15 25 -17c20 -2 25 -2 43 -2c22 0 30 0 30 -12c0 -19 -12 -19 -20 -19l-134 3l-131 -3c-3 0 -15 0 -15 11c0 20 9 20 32 20c79 0 82 10 91 47l135 539c2 9 2 11 2 16 c0 19 -27 19 -69 19c-19 0 -28 0 -28 11c0 20 13 20 20 20l133 -3l132 3c4 0 15 0 15 -12Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
                                    </defs>
                                    <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="893" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-7C" x="1465" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1744" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-29" x="2229" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2896" y="0"></use>
                                    <g transform="translate(3675,0)">
                                    <g transform="translate(397,0)">
                                    <rect stroke="none" width="2905" height="60" x="0" y="220"></rect>
                                    <g transform="translate(60,768)">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="893" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1465" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="1910" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-29" x="2396" y="0"></use>
                                    </g>
                                    <g transform="translate(568,-769)">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="893" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-29" x="1378" y="0"></use>
                                    </g>
                                    </g>
                                    </g>
                                    <use xlink:href="#E1-LATINMODERNMAIN-3D" x="7376" y="0"></use>
                                    <g transform="translate(8155,0)">
                                    <g transform="translate(397,0)">
                                    <rect stroke="none" width="4164" height="60" x="0" y="220"></rect>
                                    <g transform="translate(60,819)">
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D453" x="0" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-5B" x="552" y="0"></use>
                                    <g transform="translate(831,0)">
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D465" x="0" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-303" x="510" y="-3"></use>
                                    </g>
                                    <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1403" y="0"></use>
                                    <g transform="translate(1848,0)">
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-303" x="466" y="-3"></use>
                                    </g>
                                    <use xlink:href="#E1-LATINMODERNMAIN-5D" x="2334" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-2F" x="2612" y="0"></use>
                                    <g transform="translate(3113,0)">
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D43C" x="0" y="0"></use>
                                    <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D453" x="622" y="-219"></use>
                                    </g>
                                    </g>
                                    <g transform="translate(1309,-771)">
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-5B" x="503" y="0"></use>
                                    <g transform="translate(782,0)">
                                    <use xlink:href="#E1-LATINMODERNNORMAL-1D466" x="0" y="0"></use>
                                    <use xlink:href="#E1-LATINMODERNMAIN-303" x="466" y="-3"></use>
                                    </g>
                                    <use xlink:href="#E1-LATINMODERNMAIN-5D" x="1267" y="0"></use> 
                                    </g>
                                    </g>
                                    </g>
                                    </g>
                                    </svg>
                                    </div>
                            </div>
                        </div>
                        <br>
                    Therefore, the joint distribution p(x,y) simplifies to p(x,y) = p(y) x p(x|y) where both the marginal and conditional terms are precomputed at the environment map initialization.
                    Sampling this 2D luminance distribution is then achieved by consecutive 1D piecewise sampling of the distribution p(y) followed by p(x|y).
                    1D sampling converts a random variable on the domain [0,1] (uv-domain) to the target pixel domain with the <a href="https://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration/Sampling_Random_Variables"> Inverse Method</a>.
                    However, our solution for the light transport equation requires a sampling distribution proportional to incident solid angle directions.
                    It was only convenient to define the sampling distribution p(x,y) on the image, but this distribution must be mapped to solid angle directions. The following formula is used:
                    <br><br>
                    <div class="row">
                        <div class="col-md-2 col-lg-2 center">
                        </div>
                        <div class="col-md-10 col-lg-8">
                    <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.764ex" height="6.009ex" style="vertical-align: -2.171ex; margin-left: -0.073ex;" viewBox="-31.5 -1652.5 11954 2587.3" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                        <title id="MathJax-SVG-1-Title">p left-parenthesis omega right-parenthesis equals StartFraction p left-parenthesis theta comma phi right-parenthesis Over sine theta EndFraction equals StartFraction p left-parenthesis u comma v right-parenthesis Over 2 pi squared sine theta EndFraction period</title>
                        <defs aria-hidden="true">
                        <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D703" d="M455 500c0 -224 -152 -511 -293 -511c-91 0 -120 111 -120 205c0 229 154 511 293 511c102 0 120 -139 120 -205zM389 562c0 57 -6 121 -55 121c-45 0 -82 -56 -109 -105c-40 -71 -60 -151 -77 -215h209c24 99 32 150 32 199zM348 331h-208c-26 -98 -32 -156 -32 -198 c0 -93 21 -122 54 -122c43 0 81 49 116 117c38 72 59 157 70 203Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D719" d="M573 262c0 -134 -145 -269 -306 -274l-38 -149c-3 -14 -9 -38 -11 -40c-3 -3 -5 -4 -10 -4s-12 1 -12 11c0 3 10 41 22 88l23 94c-122 7 -192 86 -192 181c0 136 147 269 306 274l58 231c4 17 5 20 15 20c12 0 12 -10 12 -10l-3 -14l-56 -227c139 -10 192 -102 192 -181z M349 421c-149 -13 -235 -153 -235 -273c0 -100 72 -135 132 -138zM508 283c0 88 -57 134 -133 138l-103 -411c150 12 236 155 236 273Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D462" d="M543 143c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-43 0 -78 26 -89 67c-17 -22 -53 -67 -119 -67c-54 0 -123 25 -123 120c0 49 21 111 58 210c6 15 17 44 17 68c0 32 -16 33 -25 33c-38 0 -76 -37 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10 c0 9 37 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -17 -63c-26 -69 -54 -148 -54 -204c0 -37 10 -82 62 -82c73 0 113 80 114 84l75 301c8 34 34 35 39 35c15 0 29 -9 29 -27c0 -6 -10 -44 -15 -67c-4 -15 -14 -53 -17 -68l-28 -108c-8 -35 -20 -82 -20 -104 c0 -33 10 -46 31 -46c42 0 61 68 75 124c3 14 4 18 14 18c3 0 12 0 12 -10Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D463" d="M468 372c0 -52 -57 -383 -225 -383c-46 0 -134 16 -134 124c0 43 13 89 57 205c7 18 17 45 17 70c0 32 -17 32 -25 32c-29 0 -72 -23 -101 -124c-5 -16 -6 -18 -16 -18c0 0 -12 0 -12 10c0 9 38 154 132 154c50 0 82 -37 82 -82c0 -19 -5 -33 -12 -50 c-31 -83 -58 -156 -58 -212c0 -52 23 -87 74 -87c117 0 178 229 178 271c0 36 -13 62 -34 82c-11 11 -16 17 -16 30c0 22 24 48 49 48c18 0 44 -16 44 -70Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
                        <path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
                        </defs>
                        <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="893" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-29" x="1515" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-3D" x="2182" y="0"></use>
                        <g transform="translate(2961,0)">
                        <g transform="translate(397,0)">
                        <rect stroke="none" width="2913" height="60" x="0" y="220"></rect>
                        <g transform="translate(60,768)">
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="893" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1362" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D719" x="1807" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-29" x="2404" y="0"></use>
                        </g>
                        <g transform="translate(524,-726)">
                         <use xlink:href="#E1-LATINMODERNMAIN-73"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-69" x="394" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-6E" x="673" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="1396" y="0"></use>
                        </g>
                        </g>
                        </g>
                         <use xlink:href="#E1-LATINMODERNMAIN-3D" x="6670" y="0"></use>
                        <g transform="translate(7449,0)">
                        <g transform="translate(397,0)">
                        <rect stroke="none" width="3677" height="60" x="0" y="220"></rect>
                        <g transform="translate(445,768)">
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D462" x="893" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1465" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D463" x="1910" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-29" x="2396" y="0"></use>
                        </g>
                        <g transform="translate(60,-780)">
                         <use xlink:href="#E1-LATINMODERNMAIN-32" x="0" y="0"></use>
                        <g transform="translate(500,0)">
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="0" y="0"></use>
                         <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-32" x="806" y="408"></use>
                        </g>
                        <g transform="translate(1691,0)">
                         <use xlink:href="#E1-LATINMODERNMAIN-73"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-69" x="394" y="0"></use>
                         <use xlink:href="#E1-LATINMODERNMAIN-6E" x="673" y="0"></use>
                        </g>
                         <use xlink:href="#E1-LATINMODERNNORMAL-1D703" x="3087" y="0"></use>
                        </g>
                        </g>
                        </g>
                         <use xlink:href="#E1-LATINMODERNMAIN-2E" x="11644" y="0"></use>
                        </g>
                        </svg>
                        </div>
                    </div>
                </div>

                </p>
                <!--code-->
                <div class="col-md-16 col-md-offset-0" >
                    <input type="button" name="answer" value="environmental_map_illumination.cpp" onclick='showDiv(name = "myDIV11")' />
                </div>
                <div class="col-md-16 col-md-offset-0">
                    <div id="myDIV11"  style="display:none;" class="" > 
    <pre><xmp>/*
Image Based Illumination: Environment Map Emitter
by: Matias Turkulainen

Image loading supports only OpenEXR format with the built in Nori/Bitmap class I/O

Reference code: 
1. https://libraopen.lib.virginia.edu/downloads/nv935289d
2. https://github.com/mitsuba-renderer/mitsuba/blob/master/src/emitters/envmap.cpp
*/

#include <nori/emitter.h>
#include <nori/bitmap.h>
#include <filesystem/resolver.h>
#include <nori/frame.h>
#include <iostream>
#include <fstream>
#include <cstdlib>

NORI_NAMESPACE_BEGIN

// Base Eigen matrix class used for bitmap 
typedef Eigen::Array<Color3f, Eigen::Dynamic, Eigen::Dynamic, Eigen::RowMajor> Base;

class Environment_map_emitter : public Emitter {
public:

    Environment_map_emitter(const PropertyList &props){
        m_path = props.getString("image_path", "");
        filesystem::path image_path = getFileResolver()->resolve(m_path);
        std::cout<<"Image path is: "<< m_path << std::endl;
        m_bitmap = Bitmap(image_path.str());
        
        m_rows = m_bitmap.rows();
        m_cols = m_bitmap.cols();

        // Convert bitmap RGB to intensity values
        Base m_intensity = compute_intensity_map();
        
        //-------------------------------------------//
        // Precomputation of conditional and marginal PDFs used for joint distribution of luminance p(x,y)

        // m_cdf is the conditional distribution p(x|y)
        m_cdf = Base(m_rows, m_cols + 1);
        // m_pdf 
        m_pdf = Base(m_rows, m_cols);
        
        // m_pdf_marginal is the marginal distribution p(x)
        m_pdf_marginal = Base(1, m_rows);
        m_cdf_marginal = Base(1, m_cols + 1);

        //precomputing the pdf and cdf values
        Base column_sum(1, m_rows); // rows = v
        for (int i = 0; i < m_pdf.rows(); ++i) {
            // conditional pdf and conditional cdf
            column_sum(0, i) = precompute(i, m_intensity, m_pdf, m_cdf); 
        }
        //marginal pdf and cdf
        precompute(0, column_sum, m_pdf_marginal, m_cdf_marginal);  
    }

    // luminance/intensity map f(x,y)
    Base compute_intensity_map(){
        Base intensity_map(m_rows, m_cols);
        for (int row = 0; row < m_rows; row++){
            for (int col = 0; col < m_cols; col++){
                intensity_map(row,col) = 
                                        std::pow(m_bitmap(row,col).r(),2) + 
                                        std::pow(m_bitmap(row,col).g(),2) + 
                                        std::pow(m_bitmap(row,col).b(),2); 
            }
        }
        return intensity_map;
    }

    // Precomputation function defined in Monte Carlo Rendering with Natural Illumination
    float precompute(int row, const Base &f, Base &pf, Base &Pf) const {
        float I = 0;
        int i;
        for(i= 0; i < f.cols(); i++)
            // Column sum
            I += f(row)(i);
        if (I == 0)
            return I;
        for(int j = 0; j < f.cols(); j++)
            //pdf definition
            pf(row, j) = f(row, j)/I;
        Pf(row, 0) = 0;
        for(i = 1; i < f.cols(); i++)
            // cumulative pdf definition
            Pf(row,i) = Pf(row, i-1) + pf(i-1);
        Pf(row,i) = 1;
        return I;
    }

    virtual Color3f eval(const EmitterQueryRecord &lRec) const {
        // return radiance (Color) at ref point
        // Pixel coordinates from incident angle direction vector
        Point2f coords = vectorToPixel(lRec.wi); 

        //TODO: Add maybe optional scaling on the output color
        return bilinearInterpolation(coords);
    }

    virtual Color3f sample(EmitterQueryRecord &lRec, const Point2f &sample) const {
        float u;
        float v;
        float u_pdf_marginal;
        float v_pdf_conditional;

        // Sample p(y) and then p(x|y) given y.
        sample1D(0, m_pdf_marginal, m_cdf_marginal, sample.x(), u, u_pdf_marginal);
        sample1D(u, m_pdf, m_cdf, sample.y(), v, v_pdf_conditional);

        // write samples to output file
        std::ofstream file;
        file.open("/Users/maturk/git/M1Nori/nori/scenes/project/environmentMap/sample/out_samples.txt", std::fstream::app);
        file << u<<","<<v<<"\n";
        file.close();

        Point2f pixel = Point2f(u, v);
        Vector3f w = pixelToVector(pixel);
        lRec.wi = w;
        lRec.shadowRay = Ray3f(lRec.ref, lRec.wi, Epsilon, 100000);

        // Jacobian transform from pixel to solid angle distribution
        float jacobian = (m_cols - 1) * (m_rows - 1) / (2 * std::pow(M_PI, 2) * Frame::sinTheta(lRec.wi));
        // pdf in solid angles
        float pdf_solid_angle = pdf(lRec) * jacobian;
        return eval(lRec) / pdf_solid_angle;
    }
    
    void sample1D(int rowNumber, const Base &pdf, const Base &cdf , const float &sample , float &x, float &prob) const {
        int i;
        for (i = 0; i < cdf.cols(); i++) {
            if ((sample >= cdf(rowNumber)(i)) && (sample < cdf(rowNumber)(i+1)))
                break;
        }

        float t = (cdf(rowNumber)(i+1) - sample) / (cdf(rowNumber)(i+1) - cdf(rowNumber)(i));
        x = (1-t) * i + t * (i+1);
        prob = pdf(rowNumber)(i);
    }

    virtual float pdf(const EmitterQueryRecord &lRec) const{
        // PDF p(x,y) is computed by p(x,y) = p_y(y) * p_x(x|y), i.e. marginal_y * conditional_x|y.
        // First convert lRec.wi vector to pixel value. 
        Point2f pixels = vectorToPixel(lRec.wi);
        int x = floor(pixels.x());
        int y = floor(pixels.y());

        return m_pdf_marginal(0)(y)*m_cdf(x)(y);
    }

    Point2f vectorToPixel(const Vector3f &vector) const {
        // Convert vector to spherical coordinates (theta, phi)
        Point2f coords = sphericalCoordinates(vector);
        float theta = coords.x();
        float phi = coords.y();
        // Convert spherical coordinates to uv-coordinates (u,v)
        // x: from [0, pi] to [0, m_rows -1]
        // y: from [-pi, pi] to [0, m_cols -1]
        float x = (m_rows - 1) * theta * INV_PI;
        float y = (m_cols - 1) * phi * 0.5 * INV_PI;
        
        return Point2f(x,y);
    }

    Vector3f pixelToVector(const Point2f &pixel) const{
        // from pixel (x,y) to spherical coordinates
        float theta = pixel.x() * M_PI /(m_rows - 1);
        float phi = pixel.y() * 2 * M_PI / (m_cols - 1);
        //spherical coordinates
        return Vector3f(sin(theta) * cos(phi), sin(theta)*sin(phi), cos(theta)).normalized();
    }



    Color3f bilinearInterpolation(Point2f coords) const {
        int x1 = floor(coords.x());
        int y1 = floor(coords.y());
        int x2 = x1 + 1;
        int y2 = y1 + 1;
        Color3f Q11 = 0.0;
        //TODO: do we need all the checks? investigate
        if (x1 >= 0 && x1 < m_rows && y1 >= 0 && y1 <m_cols)
            Q11 = m_bitmap(x1, y1); 
        Color3f Q12 = 0.f;
        if (x1 >= 0 && x1 < m_rows && y2 >= 0 && y2 < m_cols)
            Q12 = m_bitmap(x1, y2); 
        Color3f Q21 = 0.f;
        if (x2 >= 0 && x2 < m_rows && y1 >= 0 && y1 < m_cols)
            Q21 = m_bitmap(x2, y1); 
        Color3f Q22 = 0.f;
        if (x2 >= 0 && x2 < m_rows && y2 >= 0 && y2 < m_cols)
            Q22 = m_bitmap(x2, y2); 

        auto w11 = (x2-coords.x())*(y2-coords.y())/((x2-x1)*(y2-y1));
        auto w12 = (x2-coords.x())*(coords.y()-y1)/((x2-x1)*(y2-y1));
        auto w21 = (coords.x()-x1)*(y2-coords.y())/((x2-x1)*(y2-y1));
        auto w22 = (coords.x()-x1)*(coords.y()-y1)/((x2-x1)*(y2-y1));

        return w11*Q11 + w12*Q12 + w21*Q21 + w22*Q22;

    }

    virtual std::string toString() const {
        return "Environment_map_emitter[]";
    }

protected:
    std::string m_path;
    Bitmap m_bitmap;
    Bitmap m_intensity;
    int m_cols;
    int m_rows;
    Base m_pdf;
    Base m_cdf;
    Base m_pdf_marginal; 
    Base m_cdf_marginal;
    
};

NORI_REGISTER_CLASS(Environment_map_emitter, "Environment_map_emitter")
NORI_NAMESPACE_END 
    </xmp></pre>
    </div>
                        
                </div> 

                <h4>Evaluation</h4>

                <p class="text-justify"> 
                    Here are some renders of my implementation compared to the Mitsuba 3 Physically Based Renderer:

                    <div class="col-md-16 col-md-offset-0">
                        <div style="position:relative;">
                            <div class="twentytwenty-container">
                                <img src="images/envMap/env_map_base.png" alt="Mine" class="img-responsive%;" >
                                <img src="images/envMap/mitsuba/mitsuba_ref_satara.png" alt="Referece Mitsuba3" class="img-responsive" >
                            </div>
                        </div>
                    </div>

<pre>Samples Per Pixel: 100
HDRI Image Reference:  <a href="https://polyhaven.com/a/satara_night">https://polyhaven.com/a/satara_night</a></pre>

                    <div class="col-md-16 col-md-offset-0">
                        <div style="position:relative;">
                            <div class="twentytwenty-container">
                                <img src="images/envMap/studio_mine.png" alt="Mine" class="img-responsive%;" >
                                <img src="images/envMap/mitsuba/mitsuba_studio_ref.png" alt="Referece Mitsuba3" class="img-responsive" >
                            </div>
                        </div>
                    </div>
<pre>Samples Per Pixel: 100
HDRI Image Reference:  <a href="https://polyhaven.com/a/studio_garden">https://polyhaven.com/a/studio_garden</a></pre>

                </p>
                <p class = "text-justify">
                There are some minor issues with my implementation compared to the reference Mitsuba3 renders. 
                I suspect it is due to my importance sampling in the pixel (x,y) domain not accounting for longitude-latitude distortion that occurs when mapping between different distribution domains.
                </p>
                
            </div>
        </div>


        <!--Volume Rendering/Scattering--> 
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <br>
                <h3>
                    Homogeneous Participating Media
                </h3>
                <p class="text-justify"> 
                    Participating media in graphics rendering refers to scattering effects occuring between surfaces due to non empty space. 
                    This includes scattering effects due to the atmosphere, water, or various other mediums.
                    Unlike BSDFs that characterize reflectance on single shape surfaces, scattering media are assumed to be so numerous that their scattering properties are represented by statistical distributions.
                    Volume rendering is the extension of simple path integration, defined by the light transport equation in the previous section, in a renderer that enables light transport in participating media accounting for the various losses and additions in light radiance along a ray due to absorption and emission in a media.
                    The goal of estimating the effect of participating media is to sample the following integral form of the light transport equation, referred to as the Equation of Transfer, which accounts for absorption, emission, and in-scattering of radiance along a ray path:
                    </p>
                    <!--Equation 1-->
                <div class="row">
                    <div class="col-md-2 col-lg-2 center">
                    </div>
                    <div class="col-md-10 col-lg-8">
                        <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="65.605ex" height="6.176ex" style="vertical-align: -2.338ex;" viewBox="0 -1652.5 28246.7 2659.1" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                            <title id="MathJax-SVG-1-Title">upper L Subscript normal i Superscript Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript Baseline right-parenthesis equals upper T Subscript r Baseline left-parenthesis normal p 0 right-arrow normal p Subscript Baseline right-parenthesis upper L Subscript normal o Superscript Baseline left-parenthesis normal p 0 comma minus omega Subscript Baseline right-parenthesis plus integral Subscript 0 Superscript t Baseline upper T Subscript r Baseline left-parenthesis normal p prime right-arrow normal p Subscript Baseline right-parenthesis upper L Subscript normal s Superscript Baseline left-parenthesis normal p prime comma minus omega Subscript Baseline right-parenthesis normal d t Superscript prime Baseline comma</title>
                            <defs aria-hidden="true">
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-30" d="M460 320c0 -79 -5 -157 -37 -226c-44 -95 -120 -116 -174 -116c-49 0 -122 20 -165 101c-41 76 -45 166 -45 241c0 80 5 158 37 227c41 93 114 119 174 119c42 0 124 -16 170 -112c35 -74 40 -154 40 -234zM377 332c0 63 0 139 -10 195c-19 99 -85 117 -118 117 c-25 0 -100 -9 -119 -128c-8 -54 -8 -120 -8 -184c0 -59 0 -151 11 -211c18 -96 77 -121 116 -121c45 0 102 30 117 125c11 64 11 132 11 207Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2192" d="M943 250c0 -6 -4 -11 -9 -13c-57 -19 -101 -59 -137 -104c-28 -36 -49 -80 -58 -127c-2 -9 -10 -16 -20 -16c-11 0 -20 9 -20 20c0 1 1 3 1 4c10 53 33 102 66 144c22 28 48 52 78 72h-766c-11 0 -20 9 -20 20s9 20 20 20h766c-30 20 -56 44 -78 72 c-33 42 -56 91 -66 144c0 1 -1 3 -1 4c0 11 9 20 20 20c10 0 18 -7 20 -16c9 -47 30 -91 58 -127c36 -45 80 -85 137 -104c5 -2 9 -7 9 -13Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2B" d="M722 250c0 -11 -9 -20 -20 -20h-293v-293c0 -11 -9 -20 -20 -20s-20 9 -20 20v293h-293c-11 0 -20 9 -20 20s9 20 20 20h293v293c0 11 9 20 20 20s20 -9 20 -20v-293h293c11 0 20 -9 20 -20Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNSIZE1-222B" d="M943 1268c0 -35 -25 -50 -49 -50c-23 0 -48 16 -48 49c0 25 17 47 50 49c-4 4 -29 23 -60 23c-39 0 -73 -129 -85 -178c-34 -129 -71 -329 -108 -542c-54 -321 -119 -640 -196 -956c-71 -290 -128 -524 -280 -524c-61 0 -111 42 -111 93c0 35 25 50 49 50 c23 0 48 -16 48 -49c0 -25 -17 -47 -49 -49c0 0 25 -23 61 -23c81 0 127 188 145 261c33 139 62 306 88 459c110 654 246 1156 249 1167c55 204 111 313 187 313c55 0 109 -39 109 -93Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
                            </defs>
                            <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="963" y="-213"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="978" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="1367" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1924" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="2369" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="2992" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3659" y="0"></use>
                            <g transform="translate(4715,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="826" y="-213"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="5719" y="0"></use>
                            <g transform="translate(6108,0)">
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="787" y="-213"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-2192" x="7397" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="8675" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="9231" y="0"></use>
                            <g transform="translate(9621,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="963" y="-213"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="1135" y="0"></use>
                            <g transform="translate(1524,0)">
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="787" y="-213"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2535" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2980" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="3758" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="4381" y="0"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-2B" x="14614" y="0"></use>
                            <g transform="translate(15615,0)">
                             <use xlink:href="#E1-LATINMODERNSIZE1-222B" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D461" x="1490" y="1540"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-30" x="812" y="-1270"></use>
                            </g>
                            <g transform="translate(17191,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="826" y="-213"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="18195" y="0"></use>
                            <g transform="translate(18585,0)">
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="787" y="583"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-2192" x="19807" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="21085" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="21642" y="0"></use>
                            <g transform="translate(22031,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-73" x="963" y="-213"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="1060" y="0"></use>
                            <g transform="translate(1449,0)">
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="787" y="583"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2394" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-2212" x="2839" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="3618" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="4240" y="0"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-64" x="26662" y="0"></use>
                            <g transform="translate(27218,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="511" y="583"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-2C" x="27968" y="0"></use>
                            </g>
                            </svg>
                            </div>
                    </div>  
                </div>
                <p class="text-justify"> 
                    where <i>L</i><sub>i</sub> is the incident radiance at a point <i>P</i> in space which is equal to the reflected radiance back along the ray from a surface intersection point <i>L</i><sub>o</sub> and the added radiance along the ray due to volume scattering (emission, out-scattering and attenuation, and in-scattering) up to the surface intersection point. 
                    <i>L</i><sub>s</sub> refers to source radiance which accounts for the total added radiance per unit distance due to in-scattering and emission along a ray.
                    Since most participating material are non-emissive, we assume that the source term only accounts for in-scattering, or the increased radiance due to scattering from other directions.
                    The source term is  given by
                    </p>
                    <!--Equation 2-->
                <div class="row" class="text-justify">
                    <div class="col-md-2 col-lg-2 center">
                    </div>
                    <div class="col-md-10 col-lg-8">
                        <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="44.487ex" height="5.676ex" style="vertical-align: -2.338ex;" viewBox="0 -1437.2 19154.2 2443.8" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                            <title id="MathJax-SVG-1-Title">upper L Subscript normal s Superscript Baseline left-parenthesis normal p Subscript Baseline comma omega Subscript Baseline right-parenthesis equals sigma Subscript normal s Baseline left-parenthesis normal p Subscript Baseline right-parenthesis integral Underscript script upper S squared Endscripts p left-parenthesis normal p Subscript Baseline comma omega prime Subscript Baseline comma omega Subscript Baseline right-parenthesis upper L Subscript normal i Superscript Baseline left-parenthesis normal p Subscript Baseline comma omega prime Subscript Baseline right-parenthesis normal d omega Subscript Baseline Superscript prime Baseline period</title>
                            <defs aria-hidden="true">
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D43F" d="M643 247c0 0 0 -3 -4 -14l-79 -216c-6 -17 -7 -17 -31 -17h-463c-18 0 -27 0 -27 11c0 20 10 20 27 20c79 0 81 8 91 47l134 537c3 12 4 15 4 19c0 13 -9 14 -27 16c-17 2 -38 2 -38 2c-19 0 -28 0 -28 11c0 20 12 20 19 20l133 -3l148 3c5 0 16 0 16 -12 c0 -19 -8 -19 -38 -19c-94 0 -97 -11 -106 -47l-135 -540c-5 -18 -5 -20 -5 -23c0 -8 3 -9 13 -10c6 -1 8 -1 22 -1h94c173 0 217 114 251 206c7 16 8 21 17 21s12 -7 12 -11Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-73" d="M360 128c0 -72 -46 -139 -161 -139c-21 0 -66 1 -110 43c-18 -19 -18 -21 -20 -23c-19 -19 -20 -20 -25 -20c-11 0 -11 7 -11 24v132c0 18 0 25 13 25c10 0 11 -4 14 -17c19 -85 55 -142 139 -142c78 0 113 40 113 91c0 72 -82 88 -104 92c-72 14 -100 20 -132 46 c-27 22 -43 50 -43 85c0 56 38 123 160 123c15 0 56 0 94 -28c4 3 14 12 17 16c13 12 15 12 20 12c11 0 11 -7 11 -24v-101c0 -19 0 -24 -13 -24c0 0 -11 0 -12 9c-2 31 -7 121 -117 121c-86 0 -112 -41 -112 -76c0 -58 67 -71 123 -82c42 -8 81 -16 114 -48 c12 -12 42 -42 42 -95Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNSIZE1-222B" d="M943 1268c0 -35 -25 -50 -49 -50c-23 0 -48 16 -48 49c0 25 17 47 50 49c-4 4 -29 23 -60 23c-39 0 -73 -129 -85 -178c-34 -129 -71 -329 -108 -542c-54 -321 -119 -640 -196 -956c-71 -290 -128 -524 -280 -524c-61 0 -111 42 -111 93c0 35 25 50 49 50 c23 0 48 -16 48 -49c0 -25 -17 -47 -49 -49c0 0 25 -23 61 -23c81 0 127 188 145 261c33 139 62 306 88 459c110 654 246 1156 249 1167c55 204 111 313 187 313c55 0 109 -39 109 -93Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-53" d="M499 186c0 -110 -80 -208 -197 -208c-89 0 -153 36 -184 70c-33 -53 -36 -57 -36 -57c-7 -11 -8 -13 -15 -13c-11 0 -11 7 -11 24v200c0 18 0 25 13 25c3 0 11 0 12 -10c1 -36 4 -100 62 -154c53 -49 129 -54 158 -54c84 0 134 72 134 143c0 33 -10 66 -31 92 c-28 37 -58 44 -85 51c-70 17 -121 29 -132 33c-78 27 -131 100 -131 183c0 106 84 194 195 194c89 0 130 -41 160 -70l35 57c7 12 8 13 15 13c11 0 11 -7 11 -24v-201c0 -19 0 -24 -13 -24c-11 0 -11 6 -12 12c-6 45 -28 209 -195 209c-78 0 -132 -61 -132 -131 c0 -58 39 -112 101 -127l128 -31c84 -20 150 -102 150 -202Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-32" d="M449 174l-28 -174h-371c0 24 0 26 11 37l192 214c55 62 105 141 105 221c0 82 -43 163 -134 163c-58 0 -112 -37 -135 -102c3 1 5 1 13 1c35 0 53 -26 53 -52c0 -41 -35 -53 -52 -53c-3 0 -53 0 -53 56c0 89 74 181 187 181c122 0 212 -80 212 -194 c0 -100 -60 -154 -216 -292l-106 -103h180c22 0 88 0 95 8c10 15 17 59 22 89h25Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-64" d="M527 0l-147 -11v66c-25 -32 -70 -66 -134 -66c-114 0 -212 99 -212 226c0 129 105 227 223 227c54 0 97 -26 126 -62v216c0 49 -8 56 -78 56v31l144 11v-607c0 -49 8 -56 78 -56v-31zM380 118v205c0 18 0 20 -11 37c-31 45 -73 60 -108 60c-54 0 -92 -33 -113 -64 c-29 -45 -31 -105 -31 -142c0 -41 3 -98 29 -139c24 -38 60 -64 105 -64c43 0 88 22 118 70c11 17 11 19 11 37Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
                            </defs>
                            <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-73" x="963" y="-213"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="1060" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="1449" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2006" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="2451" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="3074" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-3D" x="3741" y="0"></use>
                            <g transform="translate(4797,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-73" x="808" y="-213"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="5748" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="6137" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="6694" y="0"></use>
                            <g transform="translate(7250,0)">
                             <use xlink:href="#E1-LATINMODERNSIZE1-222B" x="0" y="0"></use>
                            <g transform="translate(574,-898)">
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-53" x="0" y="0"></use>
                             <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-32" x="685" y="483"></use>
                            </g>
                            </g>
                            <g transform="translate(8843,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="893" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1449" y="0"></use>
                            <g transform="translate(1894,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="880" y="583"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-2C" x="2905" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="3350" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="3972" y="0"></use>
                            </g>
                            <g transform="translate(13372,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D43F" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="963" y="-213"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="978" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="1367" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1924" y="0"></use>
                            <g transform="translate(2369,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="880" y="583"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="3380" y="0"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-64" x="17308" y="0"></use>
                            <g transform="translate(17865,0)">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="880" y="583"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-2E" x="18875" y="0"></use>
                            </g>
                            </svg>
                            </div>
                    </div>
                </div>
                <p class="text-justify"> 
                    where Ïƒ<sub>s</sub> is the in-scattering probability per unit distance, <i>p</i> is the phase function that describes the angular distribution of scattered radiation at a point (similar to BSDFs), 
                    and <i>L</i><sub>i</sub> is the incident radiance at that particular point in space integrated over the entire sphere of incident directions <i>Ï‰</i>. 
                    Both terms in the Equation of Transport are attenuated by the beam transmittance function <i>T</i><sub>r</sub> which describes the fraction of radiance transmitted between two points. 
                    <br><br>
                </p>
                <p class="text-justify"> 
                    Like most ray tracing methods, Monte Carlo sampling provides an unbiased estimate of the transport equation. Monte Carlo sampling the Equation of Transport results in two scenarios: 
                    1. the scene intersection point radiance term <i>L</i><sub>o</sub>, occuring at a distance <i>t</i> away from the point <i>p</i>, is sampled and estimated and 
                    2. a sample is drawn on the interval [0, <i>t</i>] and the participating media integral term is estimated. 

                    Here I only consider Homogeneous participating media which are constant density media bounded by surfaces, either within the entire scene bounding box or within shape primitives in a scene.
                </p>
                    <h4>Implementation Details</h4>

                    <p class="text-justify">
                    The main implementation challenges are to properly define the sampling methods used for each interaction type and to develop a new type of renderer, referred to as a Volume Renderer, that casts rays with incremental step-sizes proportional to the density of the media.
                    A participating media can be defined by a few key parameters, primarily by the absorption coefficient Ïƒ<sub>a</sub> and the scattering coefficient Ïƒ<sub>s</sub> which define the density of absorbed and scattered radiance per unit length respectively.
                    These coefficients also define the extinction coefficient Ïƒ<sub>t</sub> = Ïƒ<sub>a</sub> + Ïƒ<sub>s</sub> and the albedo Î± = Ïƒ<sub>s</sub> / Ïƒ<sub>t</sub>. 
                    The extinction coefficient, also referred to as the transmission coefficient, Ïƒ<sub>t</sub> is used to define the beam transmittance between points in a media. For homogeneous material, the transmittance function has an easy closed form expression given by <a href="https://en.wikipedia.org/wiki/Beerâ€“Lambert_law">Beer's</a> law: 
                    <br>
                    
                     <!--Equation 2-->
                    <div class="row text-justify">
                    <div class="col-md-2 col-lg-2 text-justify"">
                        </div>
                        <div class="col-md-10 col-lg-8">
                        <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.007ex" height="3.176ex" style="vertical-align: -0.838ex;" viewBox="0 -1006.6 8614 1367.4" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                            <title id="MathJax-SVG-1-Title">upper T Subscript r Baseline left-parenthesis normal p Subscript Baseline right-arrow normal p Superscript prime Baseline right-parenthesis equals normal e Superscript minus sigma Super Subscript normal t Superscript d Baseline period</title>
                            <defs aria-hidden="true">
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D447" d="M704 666c0 -3 -1 -13 -2 -17l-27 -174c-2 -15 -4 -23 -15 -23c-9 0 -12 7 -12 13c0 3 2 15 3 19c4 26 8 65 8 80c0 78 -45 82 -146 82c-21 0 -54 0 -63 -2c-12 -3 -16 -9 -23 -37l-133 -531c-4 -15 -4 -21 -4 -21c0 -16 8 -19 37 -22c26 -2 39 -2 64 -2c26 0 34 0 34 -11 c0 -20 -12 -20 -22 -20c-28 0 -58 2 -87 2l-83 1l-85 -1c-27 0 -55 -2 -82 -2c-6 0 -17 0 -17 12c0 19 6 19 42 19c107 0 110 11 119 48l134 534c1 3 4 15 4 21c0 8 0 12 -28 12h-39c-148 0 -174 -18 -228 -173c-6 -16 -7 -21 -17 -21c-7 0 -12 5 -12 11c0 0 5 16 6 18 l60 176c7 19 8 20 32 20h555c17 0 27 0 27 -11Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45F" d="M436 377c0 -36 -28 -59 -55 -59s-38 19 -38 35c0 26 22 50 52 55c0 0 -16 12 -42 12c-43 0 -72 -26 -80 -33c-24 -22 -52 -69 -56 -82l-32 -130c-4 -18 -38 -154 -40 -158c-7 -20 -25 -28 -37 -28c-15 0 -29 9 -29 27c0 5 6 28 9 43l58 231c13 52 16 63 16 84 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c47 0 83 -32 91 -77c19 28 63 77 128 77c51 0 83 -30 83 -65Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-70" d="M521 216c0 -129 -104 -227 -223 -227c-76 0 -118 54 -123 70v-9v-168c0 -45 11 -45 78 -45v-31l-113 3l-112 -3v31c67 0 78 0 78 45v468c0 44 -7 50 -78 50v31l144 11v-66c20 22 62 66 140 66c112 0 209 -99 209 -226zM438 216c0 113 -61 201 -134 201 c-51 0 -100 -29 -129 -80v-223c0 -20 0 -21 14 -42c27 -41 65 -61 105 -61c74 0 144 84 144 205Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2192" d="M943 250c0 -6 -4 -11 -9 -13c-57 -19 -101 -59 -137 -104c-28 -36 -49 -80 -58 -127c-2 -9 -10 -16 -20 -16c-11 0 -20 9 -20 20c0 1 1 3 1 4c10 53 33 102 66 144c22 28 48 52 78 72h-766c-11 0 -20 9 -20 20s9 20 20 20h766c-30 20 -56 44 -78 72 c-33 42 -56 91 -66 144c0 1 -1 3 -1 4c0 11 9 20 20 20c10 0 18 -7 20 -16c9 -47 30 -91 58 -127c36 -45 80 -85 137 -104c5 -2 9 -7 9 -13Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNVARIANTS-2032" d="M340 496c0 -10 -3 -20 -8 -28l-227 -372h-38l171 424c6 15 26 29 48 29c30 0 54 -24 54 -53Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-65" d="M415 119c0 -19 -45 -130 -167 -130c-115 0 -220 97 -220 231c0 125 92 228 208 228c125 0 179 -97 179 -196c0 -21 -3 -21 -25 -21h-279c0 -36 0 -102 30 -150c23 -37 63 -67 113 -67c10 0 100 0 135 103c2 8 4 14 13 14c5 0 13 -2 13 -12zM349 252 c0 39 -10 174 -113 174c-34 0 -118 -25 -124 -174h237Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-74" d="M332 124c0 -64 -28 -135 -99 -135c-36 0 -129 12 -129 135v276h-85v22c98 4 128 111 129 193h25v-184h143v-31h-143v-278c0 -17 0 -108 67 -108c37 0 67 38 67 112v55h25v-57Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D451" d="M516 683l-144 -578c-4 -17 -6 -24 -6 -48c0 -20 3 -46 30 -46c41 0 59 59 76 124c3 14 4 18 14 18c3 0 12 0 12 -10c0 0 -13 -63 -30 -99c-16 -32 -39 -55 -74 -55c-48 0 -83 33 -91 75c-60 -71 -110 -75 -130 -75c-78 0 -133 66 -133 160c0 146 124 293 241 293 c45 0 74 -27 92 -64l60 237l3 20c0 10 -2 17 -50 17c-15 0 -24 0 -24 12c0 13 6 18 14 19c17 2 112 11 127 11c13 0 13 -11 13 -11zM361 332c0 6 -14 88 -79 88c-40 0 -85 -37 -116 -96c-23 -46 -55 -169 -55 -219c0 -39 14 -94 64 -94c28 0 69 16 113 71c15 17 15 19 20 37 l50 196c1 5 3 11 3 17Z"></path>
                            <path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
                            </defs>
                            <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                             <use xlink:href="#E1-LATINMODERNNORMAL-1D447" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D45F" x="826" y="-213"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-28" x="1003" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="1393" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-2192" x="2227" y="0"></use>
                            <g transform="translate(3505,0)">
                             <use xlink:href="#E1-LATINMODERNMAIN-70" x="0" y="0"></use>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNVARIANTS-2032" x="787" y="583"></use>
                            </g>
                             <use xlink:href="#E1-LATINMODERNMAIN-29" x="4450" y="0"></use>
                             <use xlink:href="#E1-LATINMODERNMAIN-3D" x="5117" y="0"></use>
                            <g transform="translate(6174,0)">
                             <use xlink:href="#E1-LATINMODERNMAIN-65" x="0" y="0"></use>
                            <g transform="translate(444,412)">
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-2212" x="0" y="0"></use>
                            <g transform="translate(550,0)">
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
                             <use transform="scale(0.574)" xlink:href="#E1-LATINMODERNMAIN-74" x="703" y="-192"></use>
                            </g>
                             <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNNORMAL-1D451" x="1766" y="0"></use>
                            </g>
                            </g>
                            </g>
                            </svg>
                            </div>
                        </div>
                    </div>

                    <p class = "text-justify">

                    where <i>d</i> is the distance between points <i>p</i><sup>'</sup> and <i>p</i>. Since the transmittance attenuates the contribution of radiance along ray paths due to the media, sampling step sizes proportional to the transmittance allows importance sampling of the medium.   
                    The free-flight distance, or the step-size, defines the distance to the next interaction point in a scene and I randomly draw steps proportional to the transmittance function of a homogeneous media.
                    Step sizes <i>t</i> for the Beer's transmittance are given by:
                        <br>
                    <!--Sampler-->
                    <div class="row text-justify">
                        <div class="col-md-2 col-lg-2 text-justify"">
                            </div>
                            <div class="col-md-10 col-lg-8">
                                <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.018ex" height="6.009ex" style="vertical-align: -2.171ex;" viewBox="0 -1652.5 6896.5 2587.3" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                                    <title id="MathJax-SVG-1-Title">t equals minus StartFraction ln left-parenthesis 1 minus xi Subscript Baseline right-parenthesis Over sigma Subscript normal t Baseline EndFraction comma</title>
                                    <defs aria-hidden="true">
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D461" d="M330 420c0 -20 -10 -20 -30 -20h-94l-74 -295c-4 -17 -6 -24 -6 -48c0 -33 10 -46 31 -46c34 0 87 24 130 128c5 11 6 14 15 14c4 0 12 0 12 -10c0 -8 -57 -154 -159 -154c-54 0 -92 38 -92 92c0 18 4 35 76 319h-88c-20 0 -28 0 -28 12c0 19 10 19 30 19h94l39 159 c9 35 37 36 40 36c17 0 29 -10 29 -27c0 -6 -5 -26 -41 -168h88c18 0 28 0 28 -11Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2212" d="M722 250c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-6C" d="M255 0l-111 3l-111 -3v31c67 0 78 0 78 45v520c0 49 -8 56 -78 56v31l144 11v-618c0 -45 11 -45 78 -45v-31Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-6E" d="M535 0l-112 3l-113 -3v31c67 0 78 0 78 45v233c0 57 -11 111 -74 111c-64 0 -135 -56 -135 -160v-184c0 -45 11 -45 78 -45v-31l-112 3l-113 -3v31c67 0 78 0 78 45v268c0 49 -8 56 -78 56v31l141 11v-105c28 62 75 105 148 105c58 0 91 -20 105 -37 c31 -36 31 -67 31 -153v-191c1 -30 26 -30 78 -30v-31Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D709" d="M446 592c0 -31 -64 -31 -89 -31c-23 0 -46 0 -64 22c-75 -37 -111 -114 -111 -170c0 -19 4 -52 30 -78c37 12 66 12 84 12c39 0 82 -2 82 -27c0 -31 -63 -31 -93 -31c-21 0 -51 0 -88 13c-84 -42 -123 -129 -123 -170c0 -42 30 -71 75 -89l60 -24c21 -7 41 -15 61 -23 l61 -23c11 -5 48 -23 48 -71c0 -49 -42 -107 -104 -107c-56 0 -109 36 -109 48c0 4 2 11 10 11c4 0 5 -1 11 -5c11 -8 44 -32 88 -32c31 0 49 30 49 53c0 29 -20 36 -35 43c-59 23 -61 23 -121 47c-75 28 -84 32 -116 65c-2 3 -29 31 -29 79c0 36 22 130 131 202l13 10 c-47 27 -65 69 -65 106c0 77 68 157 175 187c-1 4 -7 19 -7 39c0 3 0 49 18 49c7 0 12 -5 12 -13c0 0 -5 -23 -5 -37c0 -17 2 -24 5 -33c26 5 50 5 63 5c39 0 83 -1 83 -27zM420 591c-18 5 -22 6 -56 6c-11 0 -32 0 -48 -5c11 -9 23 -9 42 -9c44 0 54 5 62 8zM352 319 c-18 5 -22 6 -57 6c-12 0 -34 0 -57 -6c18 -8 27 -8 50 -8c46 0 56 4 64 8Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70E" d="M567 407c0 -34 -36 -34 -49 -34h-110c31 -44 31 -92 31 -109c0 -154 -133 -275 -251 -275c-91 0 -150 70 -150 158c0 119 111 284 262 284h228c18 0 39 0 39 -24zM375 276c0 31 -8 97 -92 97c-34 0 -94 -14 -136 -83c-35 -59 -47 -141 -47 -171c0 -72 40 -108 89 -108 c39 0 93 26 132 85c34 51 54 133 54 180Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-74" d="M332 124c0 -64 -28 -135 -99 -135c-36 0 -129 12 -129 135v276h-85v22c98 4 128 111 129 193h25v-184h143v-31h-143v-278c0 -17 0 -108 67 -108c37 0 67 38 67 112v55h25v-57Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                                    </defs>
                                    <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D461" x="0" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-3D" x="639" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1695" y="0"></use>
                                    <g transform="translate(2474,0)">
                                    <g transform="translate(120,0)">
                                    <rect stroke="none" width="3903" height="60" x="0" y="220"></rect>
                                    <g transform="translate(60,768)">
                                     <use xlink:href="#E1-LATINMODERNMAIN-6C"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-6E" x="278" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-28" x="835" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-31" x="1224" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-2212" x="1947" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D709" x="2947" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-29" x="3394" y="0"></use>
                                    </g>
                                    <g transform="translate(1478,-686)">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D70E" x="0" y="0"></use>
                                     <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-74" x="808" y="-213"></use>
                                    </g>
                                    </g>
                                    </g>
                                    </g>
                                    </svg>
                                    </div>
                            </div>
                    </div>
                    where <i>Î¾</i> is a random number in the range [0,1]. I extend a multiple-importance sampling (MIS) ray tracer implementation with incremental step sizes proportional to the transmittance distribution of the medium for each casted ray to create a volume renderer.
                    Sampling surface interactions occurs when the step size <i>t</i>, defined above, exeeds the distance to the nearest scene intersection point.
                    I also importance sample the phase function <i>p(Ï‰, p</i><sup>'</sup><i>, p)</i> which defines the scattering directions <i>Ï‰</i><sub>o</sub> within a media. 
                    For a homogeneous medium I assume scattering is isotropic such that the distribution of scattered radiance is given by uniform sphere sampling:
                    <!--phase function-->
                    <div class="row text-justify">
                        <div class="col-md-2 col-lg-2 text-justify"">
                            </div>
                            <div class="col-md-10 col-lg-8">
                                <div class="displaymath"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.79ex" height="5.176ex" style="vertical-align: -1.838ex; margin-left: -0.073ex;" viewBox="-31.5 -1437.2 6798.6 2228.5" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
                                    <title id="MathJax-SVG-1-Title">p left-parenthesis omega Subscript normal o Baseline comma omega Subscript normal i Baseline right-parenthesis equals StartFraction 1 Over 4 pi EndFraction period</title>
                                    <defs aria-hidden="true">
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D45D" d="M490 282c0 -147 -125 -293 -241 -293c-51 0 -79 35 -92 64c-7 -25 -49 -188 -49 -200c0 -9 0 -16 50 -16c14 0 24 0 24 -11c0 -20 -13 -20 -18 -20c-32 0 -66 3 -99 3c-28 0 -57 -3 -84 -3c-8 0 -13 4 -13 12c0 19 11 19 23 19c44 0 46 7 54 41l112 445c4 17 7 28 7 51 c0 38 -14 46 -31 46c-36 0 -56 -48 -73 -119c-6 -22 -7 -23 -17 -23c0 0 -12 0 -12 10c0 3 13 63 31 97c9 18 28 57 74 57c37 0 80 -21 90 -75c33 39 81 75 131 75c76 0 133 -66 133 -160zM418 326c0 59 -24 94 -64 94c-17 0 -46 -7 -81 -38c-18 -15 -45 -43 -52 -70 l-49 -196c-3 -12 -3 -16 -3 -16c0 -6 13 -89 79 -89c37 0 85 33 119 103c18 38 51 153 51 212Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-28" d="M332 -238c0 -5 -5 -10 -10 -10c-2 0 -4 1 -6 2c-110 83 -215 283 -215 454v84c0 171 105 371 215 454c2 1 4 2 6 2c5 0 10 -5 10 -10c0 -3 -2 -6 -4 -8c-104 -78 -173 -278 -173 -438v-84c0 -160 69 -360 173 -438c2 -2 4 -5 4 -8Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D714" d="M604 372c0 -40 -12 -90 -23 -133c-30 -121 -93 -250 -197 -250c-67 0 -102 44 -113 106c-38 -62 -90 -106 -153 -106c-76 0 -105 62 -105 143c0 35 5 74 15 112c16 63 41 127 82 184c5 6 12 9 18 9c3 0 6 0 9 -2c5 -3 9 -8 9 -14c0 -4 -2 -9 -5 -13 c-38 -53 -74 -109 -89 -169c-5 -22 -8 -45 -8 -65c0 -63 26 -113 87 -113c55 0 103 39 136 93c1 29 5 59 13 90c5 22 15 47 34 47c14 0 19 -11 19 -26c0 -8 -2 -17 -4 -26c-7 -30 -17 -60 -30 -88c9 -52 42 -90 98 -90c79 0 137 92 160 183c3 12 4 25 4 37 c0 35 -13 66 -38 88c-7 7 -11 15 -11 25c0 11 5 22 14 32c10 10 23 16 35 16c9 0 17 -3 23 -9c15 -13 20 -35 20 -61Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-6F" d="M471 214c0 -127 -101 -225 -222 -225c-117 0 -221 96 -221 225c0 125 97 234 222 234c121 0 221 -106 221 -234zM388 222c0 38 0 96 -26 139s-69 65 -113 65c-40 0 -87 -21 -114 -67c-24 -44 -24 -98 -24 -137c0 -36 0 -97 25 -141c27 -46 71 -67 114 -67 c50 0 94 29 116 74c22 44 22 98 22 134Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2C" d="M203 1c0 -117 -80 -194 -91 -194c-5 0 -10 4 -10 11c0 3 0 5 11 16c33 33 68 93 68 167c0 14 -2 15 -2 15s-2 -1 -5 -3c-10 -9 -23 -13 -35 -13c-33 0 -53 26 -53 53c0 28 20 53 53 53c39 0 64 -39 64 -105Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-69" d="M247 0c-34 1 -69 3 -104 3l-110 -3v31c67 0 78 0 78 45v269c0 49 -9 55 -74 55v31l140 11v-367c0 -39 4 -44 70 -44v-31zM192 604c0 -25 -20 -53 -54 -53c-30 0 -53 26 -53 53c0 25 20 53 54 53c30 0 53 -26 53 -53Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-29" d="M288 208c0 -171 -105 -371 -215 -454c-2 -1 -4 -2 -6 -2c-5 0 -10 5 -10 10c0 3 2 6 4 8c104 78 173 278 173 438v84c0 160 -69 360 -173 438c-2 2 -4 5 -4 8c0 5 5 10 10 10c2 0 4 -1 6 -2c110 -83 215 -283 215 -454v-84Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-3D" d="M722 347c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20zM722 153c0 -11 -9 -20 -20 -20h-626c-11 0 -20 9 -20 20s9 20 20 20h626c11 0 20 -9 20 -20Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-31" d="M419 0c-35 3 -122 3 -162 3s-127 0 -162 -3v31h32c90 0 93 12 93 48v518c-52 -26 -111 -26 -131 -26v31c32 0 120 0 182 64c23 0 23 -2 23 -26v-561c0 -37 3 -48 93 -48h32v-31Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-34" d="M471 165h-100v-87c0 -36 2 -47 76 -47h21v-31c-41 3 -94 3 -136 3s-94 0 -135 -3v31h21c74 0 76 11 76 47v87h-266v31l307 469c8 12 11 12 20 12c16 0 16 -6 16 -26v-455h100v-31zM300 196v373l-244 -373h244Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNNORMAL-1D70B" d="M567 407c0 -34 -36 -34 -49 -34h-114c-11 -52 -18 -106 -18 -159c0 -28 0 -93 29 -165c6 -14 6 -16 6 -22c0 -20 -21 -38 -41 -38c-15 0 -26 6 -36 50c-8 34 -8 61 -8 76c0 67 9 110 42 258h-113l-56 -221c-13 -50 -13 -52 -27 -98c-12 -37 -20 -65 -50 -65 c-13 0 -29 8 -29 27c0 7 0 9 8 24c42 91 96 212 128 333h-57c-20 0 -78 0 -127 -77c-6 -8 -8 -12 -16 -12c-12 0 -12 10 -12 10c0 5 26 51 61 90c44 47 82 47 104 47h335c19 0 40 0 40 -24Z"></path>
                                    <path stroke-width="1" id="E1-LATINMODERNMAIN-2E" d="M192 53c0 -29 -24 -53 -53 -53s-53 24 -53 53s24 53 53 53s53 -24 53 -53Z"></path>
                                    </defs>
                                    <g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D45D" x="0" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-28" x="503" y="0"></use>
                                    <g transform="translate(893,0)">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                                     <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-6F" x="880" y="-213"></use>
                                    </g>
                                     <use xlink:href="#E1-LATINMODERNMAIN-2C" x="1969" y="0"></use>
                                    <g transform="translate(2414,0)">
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D714" x="0" y="0"></use>
                                     <use transform="scale(0.707)" xlink:href="#E1-LATINMODERNMAIN-69" x="880" y="-213"></use>
                                    </g>
                                     <use xlink:href="#E1-LATINMODERNMAIN-29" x="3334" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNMAIN-3D" x="4001" y="0"></use>
                                    <g transform="translate(4779,0)">
                                    <g transform="translate(397,0)">
                                    <rect stroke="none" width="1191" height="60" x="0" y="220"></rect>
                                     <use xlink:href="#E1-LATINMODERNMAIN-31" x="345" y="676"></use>
                                    <g transform="translate(60,-698)">
                                     <use xlink:href="#E1-LATINMODERNMAIN-34" x="0" y="0"></use>
                                     <use xlink:href="#E1-LATINMODERNNORMAL-1D70B" x="500" y="0"></use>
                                    </g>
                                    </g>
                                    </g>
                                     <use xlink:href="#E1-LATINMODERNMAIN-2E" x="6488" y="0"></use>
                                    </g>
                                    </svg>
                                    </div>
                            </div>
                    </div>
                    <br>
                    <p class="text-justify"> 
                    i.e. the distribution of scattered radiance is independent of incident direction <i>(p, p<sub>'</sub>)</i>. 
                    Russian roulette early stopping of ray casting is also implemented. Below are the class constuctors that are used to define a homogeneous medium in Nori. 
                    </p>

                    <div class="col-md-16 col-md-offset-0" >
                        <input type="button" name="answer" value="medium.h" onclick='showDiv(name = "myDIV4")' />
                    </div>
                    <div class="col-md-16 col-md-offset-0">
                        <div id="myDIV4"  style="display:none;" class="" > 
                    <pre><xmp>medium.h
/* 
    Medium Class Header
    by Matias Turkulainen
*/

#if !defined(__NORI_MEDIUM_H)
#define __NORI_MEDIUM_H

#include <nori/object.h>
#include <nori/bbox.h>
#include <nori/sampler.h>
#include <nori/common.h>

NORI_NAMESPACE_BEGIN

struct MediumQueryRecord {

        // Medium query ref. Previous origin. 
        Point3f ref;

        // Medium intersection point
        Point3f p; 

        // Maximum distance i.e. scene intersection point
        float tMax;

        // out direction vector
        Vector3f wo;

        // Incident direction vector
        Vector3f wi;

        // PDF 
        float pdf;

        /// Create an unitialized query record
        MediumQueryRecord() : tMax(0), wo(0.0){ }

        MediumQueryRecord(const Point3f &ref) : p(ref) { }
        
};

class Medium : public NoriObject {

public:
    
    virtual ~Medium() { }

    virtual EClassType getClassType() const override { return EMedium; }

    // Get transmittance Tr 
    virtual float Tr(const Point3f &x, const Point3f &y) const = 0;

    // Sample medium
    virtual float sample(MediumQueryRecord &lRec, const Point2f &sample) const = 0;

    virtual Color3f eval(const MediumQueryRecord &lRec) const = 0;

    // Assume phase functions are sampled perfectly, set pdf to phaseFunction
    virtual float pdf(const MediumQueryRecord &lRec) const {
        return phaseFunction(lRec);
    }

    // Sample free flight distance 
    virtual float sampleTr(float sample) const = 0;

    // Sample phase functions
    // Isotropic
    virtual float phaseFunction(const MediumQueryRecord &lRec) const = 0;

    // Optional custom phase function depending on wo and wi
    float phaseFunction(const Vector3f &wo, const Vector3f &wi);

    // Henyey and Greenstein phase function
    inline float PhaseHG(float cosTheta, float g) {
        float denom = 1 + g * g + 2 * g * cosTheta;
        return INV_FOURPI * (1 - g * g) / (denom * std::sqrt(denom));
    }
    void setShape(Shape * shape) {
        m_shape = shape;
    }

protected:
    /// Pointer to the shape if the emitter is attached to a shape
    Shape * m_shape = nullptr;
    // Absorption coefficient    
    float m_sigma_a;

    //Scattering coefficient
    float m_sigma_s;

    //Extinction coefficient
    float m_sigma_t;

    //Albedo
    float m_albedo;
};


NORI_NAMESPACE_END

#endif /* __NORI_INTEGRATOR_H */</xmp>
                    </pre>
                    
                    </div>
                    </div>


                    <div class="col-md-16 col-md-offset-0" >
                        <input type="button" name="answer" value="medium.cpp" onclick='showDiv(name = "myDIV6")' />
                    </div>
                    <div class="col-md-16 col-md-offset-0">
                        <div id="myDIV6"  style="display:none;" class="" > 
                    <pre><xmp>medium.cpp 
/*
Homogeneous Participating medium
by Matias Turkulainen
*/

#include <nori/medium.h>
#include <nori/warp.h>

NORI_NAMESPACE_BEGIN


class Homogeneous_participating_medium : public Medium {
public:

    Homogeneous_participating_medium(const PropertyList &props){
        m_sigma_a = props.getFloat("sigma_a", 0.1f);
        m_sigma_s = props.getFloat("sigma_s", 0.1f);
        m_sigma_t = m_sigma_a + m_sigma_s;
        m_albedo = m_sigma_s / m_sigma_t;

    }

    virtual ~Homogeneous_participating_medium() { }

    virtual Color3f eval(const MediumQueryRecord &lRec) const {
		return Color3f(1.0);
	}
    
    virtual float sample(MediumQueryRecord &lRec, const Point2f &sample) const {
		// Isotropic unifrom sampling results in unifrorm spherical sampling//
		lRec.wo = Warp::squareToUniformSphere(sample);
        // sample should give (Tr(t) * sigma_s * phase_function_value(w')) / (distance_sampling_pdf(t) * direction_sampling_pdf(w')) which evaluates to albedo for homogenous material
        if (m_albedo >= 0){return m_albedo;} 
        else {return 1.0;}
		
	}

    virtual float Tr(const Point3f &x, const Point3f &y) const {
        // Homogeneous transmission
        if (m_sigma_t > 0)
			return std::exp(-m_sigma_t * (y - x).norm());
		else
			return 1.f;
    }

    virtual float pdf(const MediumQueryRecord &lRec) const {
        return phaseFunction(lRec);
    }

    virtual float phaseFunction(const MediumQueryRecord &lRec) const {
		// Isotropic medium phase function
		return 1 / (4 * M_PI);
	}


    std::string toString() const {
		return tfm::format("Homogeneous_participating_medium[\n"
				"  m_sigma_a = %s,\n"
				"  m_sigma_s = %s,\n"
				"]", m_sigma_a, m_sigma_s);
	}


protected:
    float m_sigma_a;
    float m_sigma_s;
    float m_sigma_t;
	float m_albedo;

};

NORI_REGISTER_CLASS(Homogeneous_participating_medium, "Homogeneous_participating_medium")
NORI_NAMESPACE_END
                    </xmp></pre>
                    </div>
                    </div>
                </p>
                <p class = "text-justify">
                    Below is my implementation of a Volume Renderer with multiple importance sampling of medium transmittance, phase function, interaction type (medium or material sampling), as well as emitter sampling.
                </p>

                <div class="col-md-16 col-md-offset-0" >
                    <input type="button" name="answer" value="volumetric_path_integrator.cpp" onclick='showDiv(name = "myDIV7")' />
                </div>
                <div class="col-md-16 col-md-offset-0">
                    <div id="myDIV7"  style="display:none;" class="" > 
                <pre><xmp>/*
Volumetric Path Integrator
by Matias Turkulainen
*/

#include <nori/integrator.h>
#include <nori/emitter.h>
#include <nori/scene.h>
#include <nori/bsdf.h>
#include <nori/sampler.h>
#include <nori/medium.h>
#include <nori/warp.h>
#include <nori/shape.h>

NORI_NAMESPACE_BEGIN

class Volumetric_path_integrator : public Integrator {
public:

    Volumetric_path_integrator(const PropertyList &props) {}
    
    Color3f Li(const Scene *scene, Sampler *sampler, const Ray3f &ray) const override {
        // Recursive Monte Carlo ray-tracing in a volume medium with russian roulette early stopping
        Color3f out_color(0.0);
        Color3f throughput = 1.0;
        float successProbability;
        Color3f brdf;
        float w_mats = 1.0;
        float w_ems = 1.0;
        
        Medium *medium = scene->getMedium()[0];

        Ray3f traceRay = ray; // Ray which is traced recursively in scene. Terminated with russian roulette. 
        Intersection its; 
        
        // Check if this ray hits the scene at all or if its intersection point is at infinity
        bool bounded = scene->rayIntersect(traceRay, its);

        // MIS + Russian roulette with medium
        while (true) { 
            MediumQueryRecord mi;
            float t_max;
            if (bounded)
                t_max = (traceRay.o - its.p).norm();
            else {t_max = 100000.0;} // its.p = infinity

            mi.tMax = t_max;

            // Sample free path distance, pdf is proportional to Tr
            float t = medium->sampleTr(sampler->next1D());
            
            // Sample medium
            if(t <= t_max - Epsilon){
                mi.p = traceRay.o + t * traceRay.d.normalized(); // move to medium location defined by t-step.
                float medium_color = medium->sample(mi, sampler->next2D()); // sample medium color at this point. sets wo to random sphere direction and medium_color = albedo/pdf(phaseFunction)
                
                float mats_pdf = medium->pdf(mi); // pdf at medium point. proportional to phaseFunction

                // Emitter Light Sampling
                // Sample lights at mi.p() location
                const Emitter *light = scene->getRandomEmitter(sampler->next1D());
                EmitterQueryRecord lRec(mi.p); // set reference point as point in medium
                Color3f Li = light->sample(lRec, sampler->next2D()) * scene->getLights().size(); // Sample light source, returns color weighted by num lights in scene
                float tr = medium->Tr(mi.p, lRec.p); // Transmittance between light source and point in medium
                float ems_pdf = light->pdf(lRec); // update emitter pdf

                if (!scene->rayIntersect(lRec.shadowRay)){ // check if occluded
                    throughput *= medium_color;
                    out_color += throughput * tr  * Li * mats_pdf; // Contribution due to light source
                    //std::cout<< "tr is "<<tr<<std::endl;
                    mi.tMax = lRec.shadowRay.maxt;
                }
                else{ // Light is occluded. Only account for medium color
                    throughput *= medium_color;
                }

                // Russian Roulett early stopping
                successProbability = fmin(throughput.x(), 0.99);
                if (sampler->next1D() > successProbability)
                    return out_color;
                else { // Continue to next ray
                    throughput /= successProbability;
                }
                traceRay = Ray3f(mi.p, mi.wo.normalized()); // New ray in the direction of phase function wo
                
                if(scene->rayIntersect(traceRay, its)){
                    if (its.mesh->isEmitter()) {
                        EmitterQueryRecord lRec = EmitterQueryRecord(traceRay.o, its.p, its.shFrame.n);
                        float pdf_ems = its.mesh->getEmitter()->pdf(lRec);
                        if (mats_pdf > 0 && pdf_ems + mats_pdf > 0){
                            w_mats = mats_pdf / (ems_pdf + mats_pdf);     
                        }
                        else {w_mats = mats_pdf;}
                        out_color += throughput * w_mats * its.mesh->getEmitter()->eval(lRec) * medium->Tr(traceRay.o, its.p);
                    }   
                }
            }

            // stop early if no intersection in the scene
            else if (!bounded) {
                return out_color;
            }

            else { // Surface intersection
                    // we are at point its.p which is a scene intersection point
                mi.p = traceRay.o + mi.tMax * traceRay.d.normalized();
                if (its.mesh->isEmitter())
                    {
                        EmitterQueryRecord lRec(traceRay.o, its.p, its.shFrame.n);
                        // use previous iteration w_mats calculation and add radiance mdulated by transmittance between intersection point and origin of traceRay
                        Color3f addition = throughput * w_mats * its.mesh->getEmitter()->eval(lRec) * medium->Tr(traceRay.o, its.p);
                        out_color += throughput * w_mats * its.mesh->getEmitter()->eval(lRec) * medium->Tr(traceRay.o, its.p);
                    }
        
                // Sample random emitter in scene
                EmitterQueryRecord lRec(its.p);
                const Emitter *light = scene->getRandomEmitter(sampler->next1D());
                lRec.ref = its.p; 
                Color3f Li = light->sample(lRec, sampler->next2D()) * scene->getLights().size(); // weighted irradiance 
                float ems_pdf = light->pdf(lRec); // update emitter pdf
        
                if (!scene->rayIntersect(lRec.shadowRay)){ // check if occluded
                    float theta = Frame::cosTheta(its.shFrame.toLocal(lRec.wi));
        
                    BSDFQueryRecord bRec(its.toLocal(-traceRay.d), its.shFrame.toLocal(lRec.wi), ESolidAngle);
                    float mats_pdf = its.mesh->getBSDF()->pdf(bRec); // update bsdf pdf
                    // Calcuate w_ems weight term:
                    if (ems_pdf > 0 && ems_pdf + mats_pdf > 0){
                        w_ems = ems_pdf / (ems_pdf + mats_pdf);   
                    }
                    else {w_ems = ems_pdf;}
                    //Update tMax
                    mi.tMax = lRec.shadowRay.maxt;
                    //Update ems_color according to weight, accounting for transmittance between o() and its.p()
                    out_color += throughput * medium->Tr(traceRay.o, lRec.p) * w_ems * its.mesh->getBSDF()->eval(bRec) * Li * theta;
                }
        
                // Russian Roulette early stopping
                successProbability = fmin(throughput.x(), 0.99);
                if (sampler->next1D() > successProbability)
                    return out_color;
                else { // Continue to next ray
                    throughput /= successProbability;
                }
        
                // query bsdf at scene intersection point
                BSDFQueryRecord bRec(its.shFrame.toLocal(-traceRay.d)); 
                bRec.uv = its.uv;
                
                brdf = its.mesh->getBSDF()->sample(bRec, sampler->next2D());
                throughput *= brdf; //(wi dot n)*bsdf/pdf
        
                // Store old mats_pdf
                float mats_pdf =  its.mesh->getBSDF()->pdf(bRec);
        
                traceRay = Ray3f(its.p, its.toWorld(bRec.wo)); // update traceRay,

                bool bounded = scene->rayIntersect(traceRay, its);

                if (!scene->rayIntersect(traceRay, its))
                    return out_color;
                
                if (its.mesh-> isEmitter()) {
                    EmitterQueryRecord lRec = EmitterQueryRecord(traceRay.o, its.p, its.shFrame.n);
                    float ems_pdf = its.mesh->getEmitter()->pdf(lRec);
        
                    if (mats_pdf > 0 && ems_pdf + mats_pdf > 0){
                        w_mats = mats_pdf / (ems_pdf + mats_pdf);     
                    }
                    else {w_mats = mats_pdf;}
                }
        
                // BUG! Needed to check measure values!!!
                if (bRec.measure == EDiscrete) {
                    // Lastly check for delta distribution point lights 
                    w_mats = 1.0;
                }
            }
        }
        return out_color;
    }

    std::string toString() const {
        return "Volumetric_path_integrator[]";
    }
};

NORI_REGISTER_CLASS(Volumetric_path_integrator, "Volumetric_path_integrator");
NORI_NAMESPACE_END
                    </xmp>
                </pre>
                
                </div>
                </div>

                <br>
                <h4>Evaluation</h4>

                <p class="text-justify"> 
                    Here are some renders of my implementation compared to the Mitsuba 3 Physically Based Renderer:

                    <div class="col-md-16 col-md-offset-0">
                        <div style="position:relative;">
                            <div class="twentytwenty-container">
                                <img src="images/volume/vol_base.png" alt="Mine" class="img-responsive%;" >
                                <img src="images/volume/mitsuba_ref_001_001.png" alt="Referece Mitsuba3" class="img-responsive" >
                            </div>
                        </div>
                    </div>

<pre><xmp>Samples Per Pixel: 256
<medium type="Homogeneous_participating_medium">
<float name="sigma_a" value="0.001"/>
<float name="sigma_s" value="0.001"/>
</medium></xmp></pre>

                    <div class="col-md-16 col-md-offset-0">
                        <div style="position:relative;">
                            <div class="twentytwenty-container">
                                <img src="images/volume/test_a_.1_s_0.2.png" alt="Mine" class="img-responsive%;" >
                                <img src="images/volume/mitsuba_a0.1s0.2ref.png" alt=" Reference Mitsuba3" class="img-responsive%;" >
                                <img src="images/volume/test_sigma1_0-1_sigmas_0-5.png" alt="Mine" class="img-responsive%;" >
                                <img src="images/volume/mitsuba_ref_media.png" alt="Referece Mitsuba3" class="img-responsive" >
                            </div>
                        </div>
                    </div>
<pre><xmp>Samples Per Pixel: 256
Top Row
<medium type="Homogeneous_participating_medium">
<float name="sigma_a" value="0.1"/>
<float name="sigma_s" value="0.2"/>
</medium>
Bottom Row
<medium type="Homogeneous_participating_medium">
<float name="sigma_a" value="0.1"/>
<float name="sigma_s" value="0.5"/>
</medium></xmp></pre>

                </p>
                <br>
                
            </div>
        </div>

            <!-- final image-->
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <h1>
                    Final Render
                </h1>
                <p class="text-justify">
                    Here I attempt to recreate the motivational image. The sea floor is simulated with colored random perlin textures. 
                    I use my volume renderer to simulate absorption and scattering inside water. I simulate radial distortion and the depth of field effect with the underwater perspective camera.
                    I also use an HDRI environment map of a sea to give more texture to the background. 
                </p>
                <br>

                <div class="col-md-16 col-md-offset-0">
                    <div style="position:relative;">
                        <div class="twentytwenty-container">
                            <img src="images/final3.png" alt="Mine" class="img-responsive%;" >
                            <img src="images/motivation.png" alt="Motivation" class="img-responsive%;" >
                        </div>
                    </div>
                </div>
                <br>

            </div>
        </div>

        <!--End--> 
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <h1>
                    Acknowledgements
                </h1>
                <p class="text-justify">
                Thanks to all the teachers assistants and people at Disney Studios, Zurich who made this course possible. It was a great learning experience and got me really excited about computer graphics. 
                <br>
                The website template was borrowed from <a href="http://mgharbi.com/">MichaÃ«l Gharbi</a>.
                </p>


            </div>
        </div>
    </div>
</div>


<!-- Bootstrap core JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="resources/bootstrap.min.js"></script>
<!-- <script src="/js/offcanvas.js"></script> -->
<script src="resources/jquery.event.move.js"></script>
<script src="resources/jquery.twentytwenty.js"></script>


<script>
$(window).load(function(){$(".twentytwenty-container").twentytwenty({default_offset_pct: 0.5});});
</script>
</body>
</html>

